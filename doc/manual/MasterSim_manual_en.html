<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<meta name="author" content="Andreas Nicolai">
<title>MasterSim User Guide</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
td.tableblock>.content>:last-child.sidebarblock{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="article">
<div id="header">
<h1>MasterSim User Guide</h1>
<div class="details">
<span id="author" class="author">Andreas Nicolai</span><br>
<span id="email" class="email"><a href="mailto:andreas.nicolai@tu-dresden.de">andreas.nicolai@tu-dresden.de</a></span><br>
<span id="revnumber">version 0.8.2,</span>
<span id="revdate">Nov 2019</span>
</div>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_introduction_and_basic_concepts">1. Introduction and basic concepts</a>
<ul class="sectlevel2">
<li><a href="#_program_parts">1.1. Program parts</a></li>
<li><a href="#_supported_fmu_types">1.2. Supported FMU types</a></li>
<li><a href="#_design_criteriakey_features">1.3. Design criteria/key features</a>
<ul class="sectlevel3">
<li><a href="#_special_features_of_mastersim">1.3.1. Special features of <em>MasterSim</em></a></li>
</ul>
</li>
<li><a href="#_terminology">1.4. Terminology</a></li>
<li><a href="#_workflows">1.5. Workflows</a>
<ul class="sectlevel3">
<li><a href="#_initial_setup_of_a_simulation_scenario">1.5.1. Initial setup of a simulation scenario</a></li>
<li><a href="#_only_published_parameters_of_fmus_are_modified">1.5.2. Only published parameters of FMUs are modified</a></li>
<li><a href="#_fmus_change_internal_behavior_but_do_not_change_interface">1.5.3. FMUs change internal behavior, but do not change interface</a></li>
<li><a href="#_fmus_change_parameters_but_do_not_change_inputsoutputs">1.5.4. FMUs change parameters, but do not change inputs/outputs</a></li>
<li><a href="#_fmus_change_interface">1.5.5. FMUs change interface</a></li>
</ul>
</li>
<li><a href="#_simulation_algorithm_overview">1.6. Simulation algorithm overview</a></li>
<li><a href="#_initialization">1.7. Initialization</a>
<ul class="sectlevel3">
<li><a href="#_initial_conditions">1.7.1. Initial conditions</a></li>
<li><a href="#_simulation_start_and_end_time">1.7.2. Simulation start and end time</a></li>
</ul>
</li>
<li><a href="#_time_step_adjustment">1.8. Time step adjustment</a>
<ul class="sectlevel3">
<li><a href="#_time_step_reduction_when_algorithm_did_not_converge">1.8.1. Time step reduction when algorithm did not converge</a></li>
<li><a href="#_error_control_and_time_step_adjustment">1.8.2. Error control and time step adjustment</a></li>
</ul>
</li>
<li><a href="#_master_algorithms">1.9. Master algorithms</a>
<ul class="sectlevel3">
<li><a href="#_gauss_jacobi">1.9.1. Gauss-Jacobi</a></li>
<li><a href="#_gauss_seidel">1.9.2. Gauss-Seidel</a></li>
<li><a href="#_newton">1.9.3. Newton</a></li>
</ul>
</li>
<li><a href="#_output_writing">1.10. Output writing</a></li>
</ul>
</li>
<li><a href="#_graphical_user_interface">2. Graphical User Interface</a>
<ul class="sectlevel2">
<li><a href="#_welcome_page">2.1. Welcome page</a>
<ul class="sectlevel3">
<li><a href="#_examples">2.1.1. Examples</a></li>
</ul>
</li>
<li><a href="#_tool_bar_and_useful_keyboard_shortcuts">2.2. Tool bar and useful keyboard shortcuts</a>
<ul class="sectlevel3">
<li><a href="#_useful_shortcuts">2.2.1. Useful shortcuts</a></li>
</ul>
</li>
<li><a href="#_slaves_definition_view">2.3. Slaves definition view</a>
<ul class="sectlevel3">
<li><a href="#_adding_slaves">2.3.1. Adding slaves</a></li>
<li><a href="#_slave_propertiesparameter_values">2.3.2. Slave properties/parameter values</a></li>
<li><a href="#_network_view">2.3.3. Network view</a></li>
<li><a href="#_block_editor">2.3.4. Block editor</a></li>
</ul>
</li>
<li><a href="#_connection_view">2.4. Connection view</a>
<ul class="sectlevel3">
<li><a href="#_auto_connection_feature">2.4.1. Auto-connection feature</a></li>
<li><a href="#_assigning_transformation_operations_to_a_connection">2.4.2. Assigning transformation operations to a connection</a></li>
</ul>
</li>
<li><a href="#_simulation_settings_view">2.5. Simulation settings view</a></li>
<li><a href="#_preferences_dialog">2.6. Preferences Dialog</a></li>
</ul>
</li>
<li><a href="#_mastersimulator_the_command_line_program">3. <em>MasterSimulator</em> - the command line program</a>
<ul class="sectlevel2">
<li><a href="#_command_line_arguments">3.1. Command line arguments</a>
<ul class="sectlevel3">
<li><a href="#_workingoutput_directory">3.1.1. Working/output directory</a></li>
<li><a href="#_verbosity_of_console_and_log_file_output">3.1.2. Verbosity of console and log file output</a></li>
<li><a href="#_windows_specific_options">3.1.3. Windows specific options</a></li>
</ul>
</li>
<li><a href="#_structure_and_content_of_the_working_directory">3.2. Structure and content of the working directory</a>
<ul class="sectlevel3">
<li><a href="#_directory_log">3.2.1. Directory <code>log</code></a></li>
<li><a href="#_directory_fmus">3.2.2. Directory <code>fmus</code></a></li>
<li><a href="#_directory_slaves">3.2.3. Directory <code>slaves</code></a></li>
</ul>
</li>
<li><a href="#_return_codes_of_mastersimulator_program">3.3. Return codes of <em>MasterSimulator</em> program</a></li>
<li><a href="#_simulation_output">3.4. Simulation output</a>
<ul class="sectlevel3">
<li><a href="#_slave_output_values">3.4.1. Slave output values</a></li>
<li><a href="#_final_statisticssummary">3.4.2. Final statistics/summary</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_project_file_format">4. Project file format</a>
<ul class="sectlevel2">
<li><a href="#_simulator_settings">4.1. Simulator settings</a>
<ul class="sectlevel3">
<li><a href="#_advanced_settings">4.1.1. Advanced settings</a></li>
</ul>
</li>
<li><a href="#_simulatorslave_definitions">4.2. Simulator/Slave Definitions</a>
<ul class="sectlevel3">
<li><a href="#_csv_filereader_slaves">4.2.1. CSV FileReader Slaves</a></li>
<li><a href="#_time_points_and_time_unit">4.2.2. Time points and time unit</a></li>
<li><a href="#_interpretation_of_data_provided_in_filereader_slaves">4.2.3. Interpretation of data provided in FileReader slaves</a></li>
</ul>
</li>
<li><a href="#_connection_graph">4.3. Connection graph</a>
<ul class="sectlevel3">
<li><a href="#_fmu_parameters">4.3.1. FMU Parameters</a></li>
</ul>
</li>
<li><a href="#_blockmod_network_representation_file_format">4.4. BlockMod - Network Representation File Format</a></li>
</ul>
</li>
<li><a href="#_test_suite_concept">5. Test Suite Concept</a>
<ul class="sectlevel2">
<li><a href="#_regression_tests">5.1. Regression tests</a>
<ul class="sectlevel3">
<li><a href="#_directory_structure">5.1.1. Directory structure</a></li>
<li><a href="#_running_the_tests">5.1.2. Running the tests</a></li>
<li><a href="#_updating_reference_results">5.1.3. Updating reference results</a></li>
</ul>
</li>
<li><a href="#_cross_checking_rules_and_fmi_standard_org_listing">5.2. Cross-Checking Rules and FMI Standard.org Listing</a></li>
<li><a href="#_ways_to_generate_test_fmus">5.3. Ways to generate test FMUs</a>
<ul class="sectlevel3">
<li><a href="#_custom_c_fmus">5.3.1. Custom C++ FMUs</a></li>
<li><a href="#_fmus_exported_from_simulationx">5.3.2. FMUs exported from SimulationX</a></li>
<li><a href="#_fmus_exported_from_openmodelica">5.3.3. FMUs exported from OpenModelica</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_features_assisting_in_fmu_development_and_debugging">6. Features assisting in FMU development and debugging</a>
<ul class="sectlevel2">
<li><a href="#_modifyingfixing_fmu_content">6.1. Modifying/fixing FMU content</a></li>
</ul>
</li>
<li><a href="#_developer_information">7. Developer information</a>
<ul class="sectlevel2">
<li><a href="#_building_the_library_and_executables">7.1. Building the Library and Executables</a>
<ul class="sectlevel3">
<li><a href="#_building_on_the_command_line">7.1.1. Building on the command line</a></li>
<li><a href="#_external_libraries">7.1.2. External Libraries</a></li>
</ul>
</li>
<li><a href="#_development_environments_and_projectsession_files">7.2. Development environments and project/session files</a>
<ul class="sectlevel3">
<li><a href="#_qt_creator">7.2.1. Qt Creator</a></li>
<li><a href="#_visual_studio">7.2.2. Visual Studio</a></li>
</ul>
</li>
<li><a href="#_helpful_stuff_related_to_development_on_linux">7.3. Helpful stuff related to development on Linux</a>
<ul class="sectlevel3">
<li><a href="#_checking_symbols_in_shared_libraries">7.3.1. Checking symbols in shared libraries</a></li>
<li><a href="#_linking_shared_libraries_with_static_members_that_occurs_in_executables_as_well">7.3.2. Linking shared libraries with static members (that occurs in executables as well)</a></li>
<li><a href="#_fmu_debugging">7.3.3. FMU Debugging</a></li>
</ul>
</li>
<li><a href="#_inside_mastersim">7.4. Inside MasterSim</a>
<ul class="sectlevel3">
<li><a href="#_data_types">7.4.1. Data Types</a></li>
<li><a href="#_connection_graph_and_variable_mapping">7.4.2. Connection Graph and Variable Mapping</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_introduction_and_basic_concepts">1. Introduction and basic concepts</h2>
<div class="sectionbody">
<div class="paragraph">
<p><em>MasterSim</em> is a co-simulation master program that supports FMI co-simulation. If you are new to co-simulation in general, or not yet familiar with the Functional Mock-Up Interface (FMI), I suggest reading up a bit on the basics on the <a href="https://fmi-standard.org">fmi-standard.org</a> webpage.</p>
</div>
<div class="paragraph">
<p>Basically, <em>MasterSim</em> couples different simulation models and exchanges data between simulation slaves at runtime. The following Figure illustrates the program organisation and the basic data flow.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/DataFlowDiagram.png" alt="Data flow diagram">
</div>
<div class="title">Figure 1. Data flow and file usage diagram</div>
</div>
<div class="sect2">
<h3 id="_program_parts">1.1. Program parts</h3>
<div class="paragraph">
<p><em>MasterSim</em> consists of a two parts:</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha">
<li>
<p>graphical user interface (GUI) and</p>
</li>
<li>
<p>a command line simulator program <em>MasterSimulator</em></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The GUI makes it very easy to generate, adjust, modify simulation projects. A simulation project is stored in two files, the <em>MasterSim</em> project file and the graphical representation file. The latter is optional and not needed for the simulation.</p>
</div>
<div class="paragraph">
<p>The simulation is executed by the command line program <em>MasterSimulator</em>, which reads the project file, imports referenced FMUs and run the simulation. The generated results, both from <em>MasterSimulator</em> itself and possibly from slaves are then used by any post processing tool (like <a href="https://bauklimatik-dresden.de/postproc">PostProc 2</a>) to visualize and analize results.</p>
</div>
<div class="paragraph">
<p>The separation between user interface and actual simulator makes it very easy to use <em>MasterSim</em> in a scripted environment, or for systematic variant analysis as described below in section <a href="#_workflows">Workflows</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_supported_fmu_types">1.2. Supported FMU types</h3>
<div class="ulist">
<ul>
<li>
<p>FMI for Co-Simulation version 1</p>
</li>
<li>
<p>FMI for Co-Simulation version 2, including support for getting/setting states</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>No asynchronous FMU types supported.</p>
</div>
<div class="paragraph">
<p>On Linux and MacOS <em>MasterSim</em> is typically only built as 64-bit application. On Windows, MasterSim is available as 32-bit and 64-bit application.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For 32-bit FMUs use a 32-bit build, for 64-bit FMUs use a 64-Bit version. Mixed FMU platform types (32-Bit and 64-Bit) are not supported.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_design_criteriakey_features">1.3. Design criteria/key features</h3>
<div class="ulist">
<ul>
<li>
<p>cross-platform: Windows, MacOS, Linux</p>
</li>
<li>
<p>no dependency on externally installed libraries, all source included in release, especially no dependency on FMI support libraries (exception: standard C++, and the Qt 5 libraries); checking out source code and building it should be easy (also packaging for different platforms)</p>
</li>
<li>
<p>complete master functionality wrapped in library <em>MasterSim</em> usable by command line tools and GUI applications</p>
</li>
<li>
<p>message handling wrapped to support GUI integration and log file support, no direct <code>printf()</code> or <code>std::cout</code> statements</p>
</li>
<li>
<p>supports FMU debugging: can disable unzipping (persistant dll/so/dylib files), source access allows debugging runtime loading of shared libraries and attaching debuggers</p>
</li>
<li>
<p>high-level C++ code (readible and maintainable)</p>
</li>
<li>
<p>includes instrumentation to retrieve counters and timers for benchmarking performance of master algorithms and FMUs</p>
</li>
<li>
<p>code tailored for master algorithm debugging - all variables in type-specific arrays for <em>easy analysis in debugger</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See chapter <a href="#_features_assisting_in_fmu_development_and_debugging">Features assisting in FMU development and debugging</a> for details about functionality that are particularly important for FMU developers and for debugging problems with the co-simulation.</p>
</div>
<div class="sect3">
<h4 id="_special_features_of_mastersim">1.3.1. Special features of <em>MasterSim</em></h4>
<div class="paragraph">
<p>There is one specific feature of <em>MasterSim</em> that is helpful for using FMUs that write their own output data. To provide a writable, <em>slave-specific</em> output directory to each slave, <em>MasterSim</em> sets the parameter <code>ResultsRootDir</code> (typically with value reference 42) in each slave to this directory. As long as a slave defines such a parameter, the FMU code can rely on getting a valid directory to write its data into. See also section <a href="#_directory_slaves">Directory <em>slaves</em></a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_terminology">1.4. Terminology</h3>
<div class="paragraph">
<p>The following terms are used in the manual and also in the naming of classes/variables:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
FMU
</td>
<td class="hdlist2">
<p>describes the fmu archive including model description and shared libraries</p>
</td>
</tr>
<tr>
<td class="hdlist1">
slave/simulator
</td>
<td class="hdlist2">
<p>describes a simulation model that is instantiated/created from an FMU; there can be several slaves instantiated by a single FMU, if the capability <strong>canBeInstantiatedOnlyOncePerProcess</strong> is set to true</p>
</td>
</tr>
<tr>
<td class="hdlist1">
master
</td>
<td class="hdlist2">
<p>describes the overall simulation control framework that does all the administrative work</p>
</td>
</tr>
<tr>
<td class="hdlist1">
simulation scenario
</td>
<td class="hdlist2">
<p>defines a set of slaves and their connections (data exchange), as well as other properties such as start and end time, algorithm options, output settings; alternatively called <strong>system</strong></p>
</td>
</tr>
<tr>
<td class="hdlist1">
graph network
</td>
<td class="hdlist2">
<p>another description for the topology of interconnected slaves</p>
</td>
</tr>
<tr>
<td class="hdlist1">
master algorithm
</td>
<td class="hdlist2">
<p>describes the implementation of a mathematical algorithms that advances the coupled simulation in time; may include an iteration scheme</p>
</td>
</tr>
<tr>
<td class="hdlist1">
error control
</td>
<td class="hdlist2">
<p>means local error check (step-by-step based), used for time step adjustment scheme</p>
</td>
</tr>
<tr>
<td class="hdlist1">
master time
</td>
<td class="hdlist2">
<p>time of master simulation, starts with 0; unit is not strictly defined (needs to be common agreement between FMUs, typically in seconds, with exception of using file reader slaves, see section <a href="#_csv_filereader_slaves">CSV FileReader Slaves</a>).</p>
</td>
</tr>
<tr>
<td class="hdlist1">
current (master) time
</td>
<td class="hdlist2">
<p>the time that the master state is at, changes <strong>only</strong> at end of successful <code>doStep()</code> or  <code>restoreState()</code> calls.</p>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_workflows">1.5. Workflows</h3>
<div class="paragraph">
<p>As with any other simulation models, most workflows involve a variant analysis. In the context of co-simulation, such variants are often created by modifying FMUs and their paramters. <em>MasterSim</em> includes functionality to streamline such workflows.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Many workflows involve repeated execution of <em>MasterSim</em> with little or no modifications in the project file. Sometimes it is very convenient to use the same project file and modify it, but specify a different working directory (where outputs are stored), so that the results of different variants can be compared<br>
(see <code>--working-dir</code> command line argument described in section <a href="#_workingoutput_directory">Working/output directory</a>).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_initial_setup_of_a_simulation_scenario">1.5.1. Initial setup of a simulation scenario</h4>
<div class="paragraph">
<p>This is a straight-forward procedure:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>import all FMUs and assign slave ID names</p>
</li>
<li>
<p>(optional) specify parameter values for slaves</p>
</li>
<li>
<p>(optional) define graphical representation of slaves</p>
</li>
<li>
<p>connect output and input variables</p>
</li>
<li>
<p>set simulation parameters</p>
</li>
<li>
<p>run simulation</p>
</li>
<li>
<p>inspect results</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_only_published_parameters_of_fmus_are_modified">1.5.2. Only published parameters of FMUs are modified</h4>
<div class="paragraph">
<p>Extremely simple case and, if supported by FMUs, definitely best-practice. In <em>MasterSim</em> only the value assigned to a published parameter needs to be changed (can be done also directly in the project file, e.g. with scripts) and the simulation can be repeated.</p>
</div>
</div>
<div class="sect3">
<h4 id="_fmus_change_internal_behavior_but_do_not_change_interface">1.5.3. FMUs change internal behavior, but do not change interface</h4>
<div class="paragraph">
<p>This is the most typical case. Here, the input and output variable names and types remain unchanged and also the published parameters remain the same. Yet, the internal behavior of the model changes due to adjustment of internal model behavior, after which the FMU is exported again. Since <em>MasterSim</em> only references FMUs, in such cases the FMU files can simply be replaced and without any further changes the simulator can be started.</p>
</div>
</div>
<div class="sect3">
<h4 id="_fmus_change_parameters_but_do_not_change_inputsoutputs">1.5.4. FMUs change parameters, but do not change inputs/outputs</h4>
<div class="paragraph">
<p>In this situation, when a parameter has been configured in <em>MasterSim</em> that no longer exists (or has been renamed), the respective definition must be changed in the project file or be removed in the user interface.</p>
</div>
</div>
<div class="sect3">
<h4 id="_fmus_change_interface">1.5.5. FMUs change interface</h4>
<div class="paragraph">
<p>When an imported FMU changes part of its interface (e.g. input or output variables are modified), then this will be shown in the user interface by highlighting invalid connections. If only variable names were changed, you are best of by editing the project file and renaming the variable name there. Otherwise, simply remove the connection and reconnect.</p>
</div>
<div class="paragraph">
<p>When the variable type changes of an input/output variable, so that an invalid connection is created (or the causality changes), then the user interface may not directly show the invalid connection. However, during initialization, the <em>MasterSimulator</em> command line program will flag that error and abort.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_simulation_algorithm_overview">1.6. Simulation algorithm overview</h3>
<div class="paragraph">
<p><em>MasterSim</em> has the following main building blocks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>initialization (reading project file, extracting FMUs, checking&#8230;&#8203;)</p>
</li>
<li>
<p>initial conditions</p>
</li>
<li>
<p>time step adjustment loop</p>
</li>
<li>
<p>master algorithm (i.e. attempt to take a step)</p>
</li>
<li>
<p>error checking</p>
</li>
<li>
<p>output writing when scheduled</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These building blocks are described below in more detail.</p>
</div>
</div>
<div class="sect2">
<h3 id="_initialization">1.7. Initialization</h3>
<div class="paragraph">
<p>Upon start of the actual simulation (the command line program <em>MasterSimulator</em>, see section <a href="#_command_line_arguments">Command line arguments</a> for details on running the program), the working directory structure is being created and the log file writing is started.</p>
</div>
<div class="paragraph">
<p>Then, the project file is read and all referenced FMUs are extracted. If CSV files are referenced (see section <a href="#_csv_filereader_slaves">CSV FileReader Slaves</a>), these files are parsed and prepared for calculation.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Extraction of FMU archives can be skipped with the command line option <code>--skip-unzip</code> (see section <a href="#_modifyingfixing_fmu_content">Modifying/fixing FMU content</a>).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As first step of the actual co-sim initialzation all the FMU slaves are being instantiated (dynamic libraries are loaded and symbols are imported, afterwards <code>fmiInstantiateSlave()</code> or <code>fmi2Instantiate()</code> are called for FMI 1.0 and FMI 2.0 slaves, respectively). This is followed by a collection of all exchange variables and creation of the variable mappings.</p>
</div>
<div class="paragraph">
<p>Any error encountered during the initialization results in an abort of the simulator.</p>
</div>
<div class="sect3">
<h4 id="_initial_conditions">1.7.1. Initial conditions</h4>
<div class="paragraph">
<p>The first task of the simulator is to get all slaves to have consistent initial values. This is already a non-trivial task and not guaranteed to succeed in all cases. The only procedure that can be employed for FMI 1 and FMI 2 slaves is to iteratively get and set output and input variables in all slaves in an iterative manner, until no changes are observed.</p>
</div>
<div class="paragraph">
<p>The algorithm in <em>MasterSim</em> is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>loop over all slaves:
  - call setupExperiment() in current slave
  - set all variables of causality INPUT or PARAMETER to their
    default values as given in the modelDescription.xml
  - set all parameters to the value specified in the project file (if values are assigned)

for FMI 2: tell all slaves to enterInitializationMode()

loop with 3 iterations:
  loop over all slaves:
    get all outputs from current slave and store in global variable mapping
  loop over all slaves:
    set all input variables with values from global variable mapping

for FMI 2: tell all slaves to exitInitializationMode()</pre>
</div>
</div>
<div class="paragraph">
<p>Note, the initial calculation algorithm is actually a Gauss-Jacobi algorithm, and as such not overly stable or efficient.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you have more than 3 slaves connected in a sequence with direct feed through of variable inputs to outputs, for example when outputs are related to inputs via algebraic relations, the 3 iterationns of the Gauss-Jacobi algorithm may not be enough to properly initialize all slaves.</p>
</div>
<div class="paragraph">
<p>However, due to an unclear specification in the FMI standard, it is not required by co-simulation slaves, to update their output state whenever input changes. Most FMUs actually only update output values in a call to <code>doStep()</code>. Therefore, with the current standard it is not possible to distinguish between a direct algebraic relation between outputs and inputs <strong>without call</strong> to <code>doStep()</code> and <strong>with a call</strong> to <code>doStep()</code>.</p>
</div>
<div class="paragraph">
<p><em>MasterSim</em> chooses to adopt the FMI 1.0 functionality, i.e. no iteration over steps, and only to sync inputs and outputs under the assumption, that outputs won&#8217;t change (for most FMUs anyway), when inputs are set to different values. Under this assumption, 3 iterations are always enough.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_simulation_start_and_end_time">1.7.2. Simulation start and end time</h4>
<div class="paragraph">
<p><em>MasterSim</em> treats simulation time in <em>seconds</em>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If the coupled FMUs use a different time unit (i.e. years), simply use seconds in the user interface and project file and interpret the values as years.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The simulation time is entered in seconds (or any other supported unit that can be converted to seconds) in the user interface and project file. During the simulation, all time entries (start and end time, and time step sizes and size limits) are first converted to seconds and then used afterwards without any further unit conversion.</p>
</div>
<div class="paragraph">
<p>For example, if you specify an end time point of <code>1 h</code>, the master will run until simulation time 3600, which will then be sent as <em>communication interval end time</em> in the last <code>doStep()</code> call.</p>
</div>
<div class="paragraph">
<p>The overall simulation time interval is passed to the slaves in the <code>setupExperiment()</code> call. If you specify a start time different from 0, the master simulator will start its first communication interval at this time (the slave needs to process the <code>setupExperiment()</code> call correctly and initialize the slave to the start time point).</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The correct handling of the start time is important for all FMUs that implement some form of balancing or integration.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The end time of the simulation is also passed to the FMU via the <code>setupExperiment()</code> call (the argument <code>stopTimeDefined</code> is always set to <code>fmiTrue</code> by <em>MasterSim</em>).</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_time_step_adjustment">1.8. Time step adjustment</h3>
<div class="paragraph">
<p>Once the simulation is completed, the solver enters the time step adjustment loop. If time step adjustment is disabled via flag <strong>adjustStepSize</strong> (see <a href="#_simulator_settings">Simulator settings</a>), the loop content will only be executed once. For FMI 1.0 slaves, or FMI 2.0 slaves without capability for storing/restoring slave states, iteration is also not possible (actually, requesting an iterative algorithm for such slaves will trigger an error during initialzation).</p>
</div>
<div class="paragraph">
<p>Within the loop, the selected <em>master algorithm</em> tries to take a single step with the currently proposed time step size (for constant step methods, the <strong>hStart</strong> parameter is used). The <em>master algorithm</em> may involve iterative evaluation of slaves (see below).</p>
</div>
<div class="paragraph">
<p>For iterative master algorithms, it may be possible that the method does not converge within the given iteration limit (see parameter <strong>maxIterations</strong>).</p>
</div>
<div class="sect3">
<h4 id="_time_step_reduction_when_algorithm_did_not_converge">1.8.1. Time step reduction when algorithm did not converge</h4>
<div class="paragraph">
<p>If the algorithm did not converge within the given iteration limit, the communication  step size is reduced by factor 5:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>h_new = h/5</pre>
</div>
</div>
<div class="paragraph">
<p>The factor 5 is selected such, that the time step size can be quickly reduced. For example, when a discontinuity is encountered (e.g. triggered through step-wise change of discrete signals) the simulator must reduce the time step very quickly to a small value, to step over the step change.</p>
</div>
<div class="paragraph">
<p>The step size is then compared with the lower communication step limit (parameter <strong>hMin</strong>). This is necessary to prevent the simulation to get stuck with extremely low time steps. If the step size would be reduced below the <strong>hMin</strong> value, the simulation <strong>will be aborted</strong> with an error message.</p>
</div>
<div class="paragraph">
<p>In some cases, the interaction between two slaves may prevent any master algorithm to converge (even the Newton algorithm). Still, in these cases the remaining error may be insignificant and the simulation can tip-toe with small steps over the problematic time and increase steps afterwards. For such cases, you can specifiy the parameter <strong>hFallBackLimit</strong>, which must be larger than <strong>hMin</strong>. If h is reduced to a value below this <em>acceptable</em> communication step size, the master algorithms will return succesfully after all iterations have been done. Thus, the step is treated as <em>converged</em> and the simulation progresses to the next interval.</p>
</div>
<div class="paragraph">
<p>The publication mentioned above illustrates the behavior of the simulation using these parameters.</p>
</div>
</div>
<div class="sect3">
<h4 id="_error_control_and_time_step_adjustment">1.8.2. Error control and time step adjustment</h4>
<div class="paragraph">
<p>If an error test method (<strong>ErrorControlMode</strong>) is set, a converged step is followed by a local error check. Currently, this error check is based on the step-doubling technique and as such can only be applied if the slaves support FMI 2.0 setting/getting of state functionality.</p>
</div>
<div class="paragraph">
<p>Basically, the check is done as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>- reset slave state to begin of current communication interval
- take two steps (with full master algorithm per step)
- compute error criteria 1 and 2
- reset states back to state after first master algorithm</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>So, the error test requires two more runs of the <em>master algorithm</em> per communication step. For iterative master algorithms, or the Newton algorithm, the overhead for error tests can be significant.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The mathematical formulas and calculation details of the error check are documented in publication:</p>
</div>
<div class="paragraph">
<p>Nicolai, A.: <em>Co-Simulation-Test Case: Predator-Prey (Lotka-Volterra) System</em> (see <a href="https://bauklimatik-dresden.de/mastersim/documentation.php">MasterSim Documentation Webpage</a>).</p>
</div>
<div class="paragraph">
<p>The error check uses the parameters <code>relTol</code> and <code>absTol</code> to determine an acceptable difference between the full and half-step (or their slopes). Depending on the local error estimate, two options exist:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the local error estimate is small enough and the time step will be enlarged,</p>
</li>
<li>
<p>the error check failed; the step size will be removed and the entire communication step will be repeated</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you use an error checking algorithm in <em>MasterSim</em>, you should set a fallback time step limit. Otherwise, <em>MasterSim</em> may try to resolve the dynamics of the step change by adjusting the time steps to extremely small values.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_master_algorithms">1.9. Master algorithms</h3>
<div class="paragraph">
<p>A <em>master algorithm</em> is basically the mathematical procedure to advance the coupled simulation by one step forward. Such a co-simulation master algorithm has a characteristic set of rules on how to retrieve values from one FMU, when and how these values are passed on to other FMUs, whether this procedure is repeated and the criteria for convergence of iterations.</p>
</div>
<div class="paragraph">
<p><em>MasterSim</em> implements several standard algorithms. A detailed discussion of the different algorithms and how the choice of algorithm and parameters affect results can be found in the following publication:</p>
</div>
<div class="paragraph">
<p>Nicolai, A.: <em>Co-Simulations-Masteralgorithmen - Analyse und Details der Implementierung am Beispiel des Masterprogramms MASTERSIM</em>, <a href="http://nbn-resolving.de/urn:nbn:de:bsz:14-qucosa2-319735" class="bare">http://nbn-resolving.de/urn:nbn:de:bsz:14-qucosa2-319735</a> (in german)</p>
</div>
<div class="sect3">
<h4 id="_gauss_jacobi">1.9.1. Gauss-Jacobi</h4>
<div class="paragraph">
<p>Basic algorithm:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>loop over all slaves:
  retrieve all output values

loop over all slaves:
  set all input values
  tell slave to take a step</pre>
</div>
</div>
<div class="paragraph">
<p>Gauss-Jacobi is always done without iteration. As shown in the publication (see above), it really doesn&#8217;t make sense to use iteration.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Instead of using a communication step of 10 seconds and allow for 2 iterations of Gauss-Jacobi, it is more efficient to disable iteration (setting <strong>maxIterations=1</strong>) and restrict the communication step size to 5 seconds. The effort for the simulation will be exactly the same, yet the simulation will be more accurate (and more stable) with the 5 seconds communication interval.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_gauss_seidel">1.9.2. Gauss-Seidel</h4>
<div class="paragraph">
<p>Basic algorithm:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>iteration loop:
  loop over all slaves:
    set input values for slave from global variable list
    tell slave to take a step
    retrieve output from current slave
    update global variable list
  perform convergence check</pre>
</div>
</div>
<div class="sect4">
<h5 id="_cycles">Cycles</h5>
<div class="paragraph">
<p><em>MasterSim</em> includes a feature that reduces the calculation effort when many FMUs are involved and not all are directly coupled. The following figure shows a simulation scenario where calculation can be done in three stages.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/algorithm_cycles.png" alt="Cycles in iterative algorithms">
</div>
<div class="title">Figure 2. Cycles in iterative algorithms</div>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
(1)
</td>
<td class="hdlist2">
<p>This FMU only generates output and can be evaluated first and only once in the Gauss-Seidel algorithm.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
(2)
</td>
<td class="hdlist2">
<p>These two FMUs exchange values, they are in a <em>cycle</em>. If the Gauss-Seidel algorithm is executed with iteration enabled, only these two FMUs need to be updated and need to exchange values, since they do not require input from the other FMUs (except for the first one, whose output variables are already known).</p>
</td>
</tr>
<tr>
<td class="hdlist1">
(3)
</td>
<td class="hdlist2">
<p>The last two FMUs are also coupled in a cycle, but only to each other. They are iterated in the last stage/cycle. Since the results of the other three FMUs are already computed and known, again only two FMUs need to be in a cycle.</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Restricting the number of FMUs in a cycle not only reduces overall effort, but also takes into account the stiffness of the coupling. In one cycle, FMUs may be loosely coupled, and convergence is achieved in 2 or 3 iterations. In other cycles, FMUs may be coupled in a non-linear realtion or react more sensitive to input value changes (= stiff coupling), and 10 or more iterations may be needed. This, separating the cycles can significantly reduce computational effort in a Gauss-Seidel method.</p>
</div>
<div class="paragraph">
<p>Each FMU can be assigned a cycle, which are numbered (beginning with 0) and executed in the order of the cycle number (see simulator definition in section <a href="#_simulatorslave_definitions">Simulator/Slave Definitions</a>).</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_newton">1.9.3. Newton</h4>
<div class="paragraph">
<p>Basic algorithm:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>iteration loop:
  in first iteration, compute Newton matrix via difference-quotient approximation

  loop over all slaves:
    set all input values
    tell slave to take a step

  loop over all slaves:
    retrieve all output values

  solve equation system
  compute modifications of variables

  perform convergence check</pre>
</div>
</div>
<div class="paragraph">
<p>Cycles are handled just the same as with Gauss-Seidel.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In the case that only a single FMU is inside a cycle, the Newton master algorithm will just evaluate this FMU once and treat the results as already converged. Of course, in this case no Newton matrix is needed and composed. However, in the (rare) case, that such an FMU connects input values to <em>its own outputs</em> this may lead to problems, since potentially invalid FMU conditions are accepted.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_output_writing">1.10. Output writing</h3>
<div class="paragraph">
<p>Outputs are written after each completed step, but only if the time since last output writing is at least as long as defined in parameter <strong>hOutputMin</strong>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you really want outputs after each internal step, set <strong>hOutputMin</strong> to 0.
</td>
</tr>
</table>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_graphical_user_interface">2. Graphical User Interface</h2>
<div class="sectionbody">
<div class="paragraph">
<p><em>MasterSim</em> has a fairly convenient graphical user interface to define and adjust <em>simulation scenarios</em>. With <em>simulation scenario</em> I mean the definition of which FMUs to import and instantiate as slave (or slaves), how to connect output and input variables, and all properties related to calculation algorithms. Basically, everything that is needed to run a co-simulation.</p>
</div>
<div class="sect2">
<h3 id="_welcome_page">2.1. Welcome page</h3>
<div class="paragraph">
<p>The software starts with a welcome page, which basically shows a list of recently used projects and some webbases news (those are pulled from the file <a href="https://bauklimatik-dresden.de/downloads/mastersim/news.html" class="bare">https://bauklimatik-dresden.de/downloads/mastersim/news.html</a> which is updated whenever a new release or feature is available).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/gui_welcome_page.png" alt="Welcome page">
</div>
<div class="title">Figure 3. Welcome page with recently used projects and webbased news</div>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
(1)
</td>
<td class="hdlist2">
<p>Thumbnail with a preview of the simulation scenario</p>
</td>
</tr>
<tr>
<td class="hdlist1">
(2)
</td>
<td class="hdlist2">
<p>Short description of the project . This description is taken from the project file header comment lines (see <a href="#_project_file_format">Project file format</a>).</p>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The thumbnails shown on the welcome page are generated/updated when the project is saved. The files are placed inside the user&#8217;s home directory:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>on Windows in <code>%APPDATA\Roaming\MasterSim\thumbs</code>, and</p>
</li>
<li>
<p>on Linux/MacOS in <code>~/.local/share/MasterSim</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>and the image file is named like the project file with appended <code>png</code> extension.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_examples">2.1.1. Examples</h4>
<div class="paragraph">
<p>When opening an example from the welcome page / example page, you are prompted to save the project first in a custom location (examples are distributed in the installation directory, which is usually read-only).</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_tool_bar_and_useful_keyboard_shortcuts">2.2. Tool bar and useful keyboard shortcuts</h3>
<div class="paragraph">
<p>As soon as a project is created/opened, one of the project content views is shown, and a tool bar is shown to the left side of the program. The icons of the tool bar have the following functionality (also indicated by a tool tip when hovering with the mouse cursor over the button):</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
Programm&#160;Information
</td>
<td class="hdlist2">
<p>Shows program info</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Create new
</td>
<td class="hdlist2">
<p>Creates a new project (shortcut <strong>Ctrl + N</strong>)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Open project
</td>
<td class="hdlist2">
<p>Opens a <code>*.msim</code> project file (shortcut <strong>Ctrl + O</strong>)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Save project
</td>
<td class="hdlist2">
<p>Saves the current project (shortcut <strong>Ctrl + S</strong>) (also saves the network representation)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Open PostProc
</td>
<td class="hdlist2">
<p>Opens the post processing tool specified in the preferences dialog. While I would recommend to use <a href="https://bauklimatik-dresden.de/postproc">PostProc 2</a>, you can start here any other postproc software, or even an automated analysis script. Simple set the appropriate command line in the preferences dialog.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
FMU Analysis
</td>
<td class="hdlist2">
<p><em>MasterSim</em> will unzip all referenced FMUs and read their model description files. It also updates the graphical schematics and connection views, if FMU interfaces have changed. Also, the property table is updated. Use this feature if you have updated an FMU in the file system and want to reflect those changes in the <em>MasterSim</em> user interface (alternatively, simply reload the project).</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Slave definition view
</td>
<td class="hdlist2">
<p>Switches to the <a href="#_slaves_definition_view">Slaves definition view</a>. Here you define which FMUs are important, and assign parameter values to slaves. Also, you can design a graphic representation of the network.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Connection view
</td>
<td class="hdlist2">
<p>Switches to the <a href="#_connection_view">Connection view</a>. Here you can manage the connections between slaves and assign special attributes (transformations) between connections.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Simulation settings view
</td>
<td class="hdlist2">
<p>Switches to the <a href="#_simulation_settings_view">Simulation settings view</a>. All simulation parameters and numerical algorithm options are specified here. Also, the actual simulation is started from this view.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Undo/Redo
</td>
<td class="hdlist2">
<p>The next two buttons control the undo/redo functionality of the unse interface. All changes made to the project can be reverted and re-done (shortcuts are <strong>Ctrl + Z</strong> for undo, and <strong>Ctrl + Shift + Z</strong> for redo).</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Language switch
</td>
<td class="hdlist2">
<p>The next buttons opens a context menu with language selection. You need to restart the application to activate the newly selected language.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Quit
</td>
<td class="hdlist2">
<p>Close the software. If the project has been changed, user is queried to save or discard the changes.</p>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_useful_shortcuts">2.2.1. Useful shortcuts</h4>
<div class="paragraph">
<p>Here&#8217;s a list of useful program-wide shortcuts:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Program wide shortcuts</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 40%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Windows/Linux</th>
<th class="tableblock halign-left valign-top">MacOS</th>
<th class="tableblock halign-left valign-top">Command</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Ctrl + N</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>⌘ + N</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">create new project</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Ctrl + O</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>⌘ + O</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">load project</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Ctrl + S</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>⌘ + S</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">save project</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Ctrl + Shift + S</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>⌘ + Shift + S</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">save project with new filename</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Ctrl + Z</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>⌘ + Z</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">undo</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Ctrl + Shift + Z</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>⌘ + Shift + Z</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">redo</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>F2</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>F2</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">open project file in text editor</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>F9</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>F9</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">start simulation (can be used from any view, no need to switch to simulation settings view first!)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>⌘ + .</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Open preferences dialog</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_slaves_definition_view">2.3. Slaves definition view</h3>
<div class="paragraph">
<p>The input of the simulation scenario is split into three views. Setting up a simulation starts with importing slaves. So, the first (and most important) view is the slave definition view.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/gui_slave_view.png" alt="Slave view">
</div>
<div class="title">Figure 4. Slave definition view shows list of imported FMUs, assigned slave ID names and an optional graphical representation</div>
</div>
<div class="paragraph">
<p>Items of the view:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
(1)
</td>
<td class="hdlist2">
<p>Adds a new slave by selecting an FMU file (<code>*.fmu</code>) or a file reader slave (<code>csv</code> or <code>tsv</code> file, see section <a href="#_csv_filereader_slaves">CSV FileReader Slaves</a>)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
(2)
</td>
<td class="hdlist2">
<p>Removes the currently selected slaves (and all connections made to it)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
(3)
</td>
<td class="hdlist2">
<p>Double-click to change color of slave (colour is used to identify slave in connection view)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
(4)
</td>
<td class="hdlist2">
<p>ID name of slave. By default <em>MasterSim</em> assigns the basename of the fmu file path. Double-click on the cell to change the same. Mind: slave ID names must be unique within a simulation scenario.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
(5)
</td>
<td class="hdlist2">
<p>Path to FMU file, either absolute path or relative to current <em>MasterSim</em> project file, depending in the checkbox <em>"Show FMU paths relative to project file"</em>. Also, the project must have been saved, before relative paths can be shown.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
(6)
</td>
<td class="hdlist2">
<p>Defines in which cycle the FMU is to be calculated (by default, all slaves are in cycle 0 and thus all are assumed to be coupled). See description of <a href="#_master_algorithms">master algorithms</a>.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
(7)
</td>
<td class="hdlist2">
<p>Activate graphical connection mode (see discussion below). When this mode is active, you can drag a new connection from an output to inlet socket in the network.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
(8)
</td>
<td class="hdlist2">
<p>Print network schematics to printer or pdf file.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
(9)
</td>
<td class="hdlist2">
<p>This is the graphical network schematics - purely optional, but helps to understand what you are doing.</p>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you want to rearrange several blocks at the same time, you can select multiple blocks by <strong>Ctrl + Click</strong> on a block. If you move one of the selected blocks now, the other selected blocks will be moved as well.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_adding_slaves">2.3.1. Adding slaves</h4>
<div class="paragraph">
<p>New slaves are added by selecting <code>fmu</code> or  <code>csv</code> or <code>tsv</code> files. <em>MasterSim</em> automatically uses the basename of the selected file as ID name for the slave. If already such an ID name exists, <em>MasterSim</em> appends a number to the basename. In any case, slave ID names must be unique within the project.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can import the same FMU several times, unless the FMU has the capability flag <strong>canBeInstantiatedOnlyOncePerProcess</strong> set to <em>false</em>. In this case, the slaves will have different ID names, yet reference the same FMU file. Parameters and visual appearance can be set differently for slave of the same FMU.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_slave_propertiesparameter_values">2.3.2. Slave properties/parameter values</h4>
<div class="paragraph">
<p>Below the table with imported slaves is a list of parameters published by the FMU. The list is specific to the <em>currently selected</em> slave. A simulator slave can be selected in the slave table or by clicking on a block in the network view.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/gui_slave_view_properties.png" alt="Slave parameter table">
</div>
<div class="title">Figure 5. Table with slave-specific parameter values</div>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
(1)
</td>
<td class="hdlist2">
<p>Black and bold fonts indicate, that this parameter has been modified/set to a specific value. Gray italic text shows the default, unmodified value.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
(2)
</td>
<td class="hdlist2">
<p>Hovering with the mouse over a parameter value will show a tool tip with the default parameter. This can be used to see the default value in the case that a parameter was modified.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
(3)
</td>
<td class="hdlist2">
<p>Parameters written in bold face and black are set by <em>MasterSim</em> (during initialization).</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Parameters can be edited by <strong>double-clicking</strong> on the value cell and entering a value. Clearing the content of the cell will reset the parameter to its default value.</p>
</div>
</div>
<div class="sect3">
<h4 id="_network_view">2.3.3. Network view</h4>
<div class="paragraph">
<p>The network view <strong>(9)</strong> shows a simple schematic of all FMU slaves and their connections. This network view is optional and not really needed for the simulation. Still, a visual representation of the simulation scenario is important for communication.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can zoom in and out of the network view by using the mouse scroll button. The scene is zoomed in at the position of the mouse cursor.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The network shows <strong><em>blocks</em></strong> (matching the simulators/slaves) and on each of the blocks one or more <strong><em>sockets</em></strong>. Sockets indicate input/output variables of each simulation slave. Blocks are shown in different colors, indicating the individual <a href="#_block_states">block states</a>.</p>
</div>
<div class="sect4">
<h5 id="_creating_connections_in_network_view">Creating connections in network view</h5>
<div class="paragraph">
<p>You can create new connections between slave&#8217;s outputs and inputs by first putting the network in <em>connection mode</em> by pressing button <strong>(7)</strong>. When in connection mode, the cursor inside the network view window changes to a cross. You can then move the mouse over an outlet socket (triangle), <em>press and hold</em> the mouse button and drag the connection to a <em>free</em> inlet socket (empty semi-circle). Once the connection has been made, connection mode is disabled again and blocks and connectors can be moved around.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can leave <em>connection mode</em> by pressing right-click in the network view.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Connections between slaves can be defined more conveniently in the <a href="#_connection_view">Connection view</a> (which is also more efficient when making many connections, compared to manually dragging the connections with the mouse).</p>
</div>
</div>
<div class="sect4">
<h5 id="_block_states">Block states</h5>
<div class="paragraph">
<p>Because <em>MasterSim</em> only references FMUs, their actual content (i.e. interface properties from <code>modelDescription.xml</code>) is only known when they are imported. The FMU import and analysis step is done automatically, when a project is opened and when a new FMU slave is added.</p>
</div>
<div class="paragraph">
<p>When importing an FMU the user interface will attempt to unzip the FMU archive and analyse its content. If the <code>modelDescription.xml</code> file could be read correctly, <em>MasterSim</em> will offer to open the block editor. Inside the editor you can define the basic geometry of the block (slave representation) and the layout of the sockets (the positions of inlet and outlet variables). You can ignore this request and leave the FMU visual representation undefined. Basically, an FMU can have three states that are visualized differently in the UI:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/bm_block_states.png" alt="Block states">
</div>
<div class="title">Figure 6. Different states of blocks and their visual appearance</div>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
(1)
</td>
<td class="hdlist2">
<p>The referenced <code>fmu</code> file does not exist or cannot be read (not a zip archive, cannot be extracted, doesn&#8217;t contain a <code>modelDescription.xml</code> file, or not a valid file, &#8230;&#8203; many things can go wrong here)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
(2)
</td>
<td class="hdlist2">
<p>The model description has been parsed successfully for this slave, but the block definition doesn&#8217;t match the interface (yet). Typically, when an FMU has been imported the first time, the corresponding block definition does not yet have any sockets defined or layed out, so simply a red box is shown. You can <strong>double-click</strong> on such a box to open the block editor.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
(3)
</td>
<td class="hdlist2">
<p>The block has been defined and the sockets match those indicated by the model description (in name and inlet/outlet type).</p>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_block_editor">2.3.4. Block editor</h4>
<div class="paragraph">
<p>The block editor allows you to define the basic, rectangular shape of your FMU and to layout your sockets. The block editor is opened either directly after an FMU has been imported, or when <strong>double-clicking</strong> on a block in the network view.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/bm_block_editor.png" alt="Block Editor">
</div>
<div class="title">Figure 7. Editor for block geometry and socket layout</div>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
(1)
</td>
<td class="hdlist2">
<p>Slave ID name</p>
</td>
</tr>
<tr>
<td class="hdlist1">
(2)
</td>
<td class="hdlist2">
<p>Shows number of published input and output variables</p>
</td>
</tr>
<tr>
<td class="hdlist1">
(3)
</td>
<td class="hdlist2">
<p>If checked, the FMU archive is searched for the image file <code>model.png</code> (should be besides <code>modelDescription.xml</code> file in root directory of FMU archive), and if present, the image is shown scaled to the block size</p>
</td>
</tr>
<tr>
<td class="hdlist1">
(4)
</td>
<td class="hdlist2">
<p>Here, you can define the width and height of the block in grid lines</p>
</td>
</tr>
<tr>
<td class="hdlist1">
(5)
</td>
<td class="hdlist2">
<p>This button will automatically lay out the sockets. Inputs are aligned to the left and top side. Outputs are aligned at the right and bottom side. If there is not enough space for all sockets, the remaining sockets are placed over each other.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
(6)
</td>
<td class="hdlist2">
<p>Indicates an inlet socket (input variable)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
(7)
</td>
<td class="hdlist2">
<p>Indicates an outlet socket (output variable)</p>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
In one of the next program versions, it will be possible to store block appearances as templates for future use of similar/same FMUs. For now, you have to configure the block every time you import an FMU. Also, advanced customization and custom socket locations is not yet implemented.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_connection_view">2.4. Connection view</h3>
<div class="paragraph">
<p>In this view you can connect slaves by mapping output to input variables.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/gui_connection_view.png" alt="Connection view">
</div>
<div class="title">Figure 8. Connection view with published input and output variables for all slaves and defined connections</div>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
(1)
</td>
<td class="hdlist2">
<p>Shows all published output variables of all slaves.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
(2)
</td>
<td class="hdlist2">
<p>Shows input variables of all slaves, that have <strong>not</strong> been connected, yet.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
(3)
</td>
<td class="hdlist2">
<p>Select first an output variable and the input variable, that should be connected to the output, then press this button to create the connection.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
(4)
</td>
<td class="hdlist2">
<p>Here, you can create multi connections between two slaves based on variable names (see explanation below)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
(5)
</td>
<td class="hdlist2">
<p>This removes the currently selected connection in table (6)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
(6)
</td>
<td class="hdlist2">
<p>Shows all connections already made. <strong>Double-click</strong> on last column to assign transformation operations.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
(7)
</td>
<td class="hdlist2">
<p>Table with all slaves and their colors (to assist in identifying variables by colour)</p>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_auto_connection_feature">2.4.1. Auto-connection feature</h4>
<div class="paragraph">
<p>This feature is very helpful if FMUs are coupled, where output and input variables of two slaves have the same name. This is particularly helpful, if you have to connect many input and output variables between two slaves. If you create one FMU such, that variable names match the other side, you can use the following procedure:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>in the combo boxes select the slaves to be connected</p>
</li>
<li>
<p>press the connection button</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>A connection is created, when:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the variable name matches</p>
</li>
<li>
<p>the variable data type matches</p>
</li>
<li>
<p>one variable has causality <em>input</em>, and the other has causality <em>output</em></p>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="title">Example 1. Auto-connection of two slaves</div>
<div class="content">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>slave1 publishes:</p>
<div class="ulist">
<ul>
<li>
<p>Room1.Temperature (real, output)</p>
</li>
<li>
<p>Room1.HeatingPower (real, input)</p>
</li>
<li>
<p>Room1.OperativeTemperature (real, output)</p>
</li>
</ul>
</div>
</li>
<li>
<p>slave2 publishes:</p>
<div class="ulist">
<ul>
<li>
<p>Room1.Temperature (real, input)</p>
</li>
<li>
<p>Room1.HeatingPower (real, output)</p>
</li>
<li>
<p>Room2.OperatingTemperature (real, input)</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Auto-connection creates:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>slave1.Room1.Temperature  &#8594; slave2.Room1.Temperature</p>
</li>
<li>
<p>slave1.Room1.HeatingPower &#8594; slave2.Room1.HeatingPower</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Third connection is not made, since <em>Room1.OperativeTemperature</em> does not match <em>Room2.OperatingTemperature</em>.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_assigning_transformation_operations_to_a_connection">2.4.2. Assigning transformation operations to a connection</h4>
<div class="paragraph">
<p>If you want to do unit conversion or other transformations (sign inversion, scaling) between output variables and input variables, you can <strong>double-click</strong> on the third column in table <strong>(6)</strong>, to open a dialog for editing transformation factors and offsets. See section <a href="#_connection_graph">Connection graph</a> for a detailed description.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_simulation_settings_view">2.5. Simulation settings view</h3>
<div class="paragraph">
<p>All settings that control the actual co-simulation algorithm are defined here. Detailed description of the settings and their usage is given in section <a href="#_master_algorithms">Master Algrithms</a>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Section <a href="#_simulator_settings">Project file reference - Simulator settings</a> describes the corresponding  entries in the <em>MasterSim</em> project file.
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/gui_simulation_settings_view.png" alt="Simulation view">
</div>
<div class="title">Figure 9. Simulation settings and simulation start view</div>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
(1)
</td>
<td class="hdlist2">
<p>Here you can define the start and end time point of the simulation.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
(2)
</td>
<td class="hdlist2">
<p>The initial communication interval size. When time step adustment <strong>(7)</strong> is disabled, this communication interval size will be used until the end simulation time has been reached.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
(3)
</td>
<td class="hdlist2">
<p>Selection of the master algorithm</p>
</td>
</tr>
<tr>
<td class="hdlist1">
(4)
</td>
<td class="hdlist2">
<p>Maximum number of iterations, 1 disables iteration</p>
</td>
</tr>
<tr>
<td class="hdlist1">
(5)
</td>
<td class="hdlist2">
<p>The relative and absolute tolerances are used for converence check of iterative algorithms and, if enabled, for local error checking and time step adjustment.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
(6)
</td>
<td class="hdlist2">
<p>Here you can select an error control method, see section <a href="#_error_control_and_time_step_adjustment">Error control and time step adjustment</a>.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
(7)
</td>
<td class="hdlist2">
<p>If checked, <em>MasterSim</em> will adjust the time step, requires FMUs to support the <strong>canHandleVariableCommunicationStepSize</strong> capability</p>
</td>
</tr>
<tr>
<td class="hdlist1">
(8)
</td>
<td class="hdlist2">
<p>These three parameters control how the time step is adjusted in case of converence/error test failures.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
(9)
</td>
<td class="hdlist2">
<p>If checked, <em>MasterSim</em> will adjust the step size of the last interval such, that is gives <em>exactly</em> the end time point of the simulation as end of the last communication interval, regardless of flag <strong>(7)</strong> (see discussion in section <a href="#_time_step_adjustment">Time step adjustment</a>).</p>
</td>
</tr>
<tr>
<td class="hdlist1">
(10)
</td>
<td class="hdlist2">
<p>Defines the minimum interval that needs to pass before a new output is written. Helps to reduce amount of outputs in case of variable time steps when these time steps can become much smaller than a meaningful output grid.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
(11)
</td>
<td class="hdlist2">
<p>If checked, <em>MasterSim</em> also writes the values of internal variables to the output files, otherwise only variables of causality <em>output</em>. Useful mainly for debugging/FMU analysis, or to obtain internal values that are not written to output files by the FMU itself.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
(12)
</td>
<td class="hdlist2">
<p>Lets you control the verbosity level of the console solver output (see <a href="#_command_line_arguments">Command line arguments</a>)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
(13)
</td>
<td class="hdlist2">
<p>Command line that is used to run the simulator. Can be copied into a shell script or batch file for automated processing.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
(14)
</td>
<td class="hdlist2">
<p>The big fat start button. <strong>Ready, Steady, Go!</strong></p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When you start the simulation, a console window will appear with progress/warning/error message output of the running simulation. Since some simulations can be very fast, after about 2 seconds the log windows is shown with the current screenlog&#8217;s content.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Mind, that the simulation may still be running in the background, even if the log window is already shown. If you start the simulation several times, you will spawn multiple simulation processes in parallel. This would just be a waste, since the simulations would write into the same directories and overwrite each other&#8217;s files.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_preferences_dialog">2.6. Preferences Dialog</h3>
<div class="paragraph">
<p>The preferences dialog, opened from the main menu or via application shortcut, currently provides configuration options for the text editor (used to edit the project file with the short cut <strong>F2</strong>) and the post processing executable.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/gui_preferences_tools.png" alt="Preferences dialog">
</div>
<div class="title">Figure 10. Preference dialog with input options for text editor and post-processing executable</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
When you edit a project file in the external text editor and save the file, the next time you bring the <em>MasterSim</em> user interface into focus, it will prompt to re-load the modified project.
</td>
</tr>
</table>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_mastersimulator_the_command_line_program">3. <em>MasterSimulator</em> - the command line program</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The actual simulation is done by the <code>MasterSimulator</code> command line program. It basically performs the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Read the msim project file (the network representation file is ignored, since it only contains visual information).</p>
</li>
<li>
<p>Then, a working directory for this simulation test case is created (path can be adjusted, see <code>--working-dir</code> command line option below).</p>
</li>
<li>
<p>The FMUs are extracted (can be skipped if already extracted, see command line option <code>--skip-unzip</code> below)</p>
</li>
<li>
<p>The simulation is run as defined in the project file</p>
</li>
</ol>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Using <em>MasterSim</em> in a scripted environment</div>
<div class="paragraph">
<p>Since the <em>MasterSim</em> project file is plain text and the solver can be started on the command line, it is possible to use <em>MasterSim</em> in a scripted environment and automated processes (e.g. for optimization calculations).</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_command_line_arguments">3.1. Command line arguments</h3>
<div class="paragraph">
<p>General Syntax for the MasterSimulator command line tool:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Syntax: MasterSimulator [flags] [options] &lt;project file&gt;

Flags:
  --help            Prints the help page.
  --man-page        Prints the man page (source version) to std output.
  --cmd-line        Prints the command line as it was understood by the command
                    line parser.
  --options-left    Prints all options that are unknown to the command line
                    parser.
  -v, --version     Show version info.
  -x, --close-on-exit  Close console window after finishing simulation.
  -t, --test-init   Run the initialization and stop right afterwards.
  --skip-unzip      Do not unzip FMUs and expect them to be unzipped in
                    extraction directories.

Options:
  --verbosity-level=&lt;0..4&gt;
                    Level of output detail (0-4).
  --working-dir=&lt;working-directory&gt;
                    Working directory for master.</pre>
</div>
</div>
<div class="sect3">
<h4 id="_workingoutput_directory">3.1.1. Working/output directory</h4>
<div class="paragraph">
<p>If no working directory is given, the directory path is generated from the project file path with extension removed. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="c"># path to project file</span>
/simulations/myScenario.msim

<span class="c"># outputs will be written to</span>
/simulations/myScenario/...</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the section <a href="#_structure_and_content_of_the_working_directory">Structure and content of the working directory</a> the content of the working directory is explained.</p>
</div>
</div>
<div class="sect3">
<h4 id="_verbosity_of_console_and_log_file_output">3.1.2. Verbosity of console and log file output</h4>
<div class="paragraph">
<p>MasterSimulator writes progress information/warning and error messages to the console window, and to the file <code>&lt;working-dir&gt;/logs/screenlog.txt</code>. The amount of text to be written and the detail level is controlled through the <code>--verbosity-level</code> parameter, which determines the amount of debug information generated by the master.</p>
</div>
<div class="paragraph">
<p>Verbosity level of 0 disables pretty much all output, verbosity level 1 is the default with normal progress message output. Use higher verbosity levels for debugging purposes or to narrow down the source of an error.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The log file verbosity is always set to 3 during initialization and reset to the default value of 1 or command line value during simulation (to avoid slowdown of the simulation due to excessive output writing).</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_windows_specific_options">3.1.3. Windows specific options</h4>
<div class="paragraph">
<p>By default, the console window (on Windows) stays open at the end of the simulation unless the <code>-x</code> command line flag is passed.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_structure_and_content_of_the_working_directory">3.2. Structure and content of the working directory</h3>
<div class="paragraph">
<p>By default, the following directory structure is used. Suppose there is a project file <code>simProject.msim</code> describing the simulation scenario using two provided FMUs <code>part1.fmu</code> and <code>part2.fmu</code> which are referenced inside the project as simulation slaves <strong>P1</strong> and <strong>P2</strong>, respectively. Let&#8217;s assume these files are located in some subdirectory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>/sim_projects/pro1/simProject.msim
/sim_projects/pro1/fmus/part1.fmu
/sim_projects/pro1/fmus/part2.fmu</pre>
</div>
</div>
<div class="paragraph">
<p>When running the master simulator a working directory will be created. By default the file path to this working directory is the project file name without extension.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>/sim_projects/pro1/simProject/             - working directory
/sim_projects/pro1/simProject/log/         - log and statistic files
/sim_projects/pro1/simProject/fmus/        - unzipped fmu subdirectories
/sim_projects/pro1/simProject/fmus/part1   - unzipped part1.fmu
/sim_projects/pro1/simProject/fmus/part2   - unzipped part2.fmu
/sim_projects/pro1/simProject/slaves/      - output/working directory for fmu slaves
/sim_projects/pro1/simProject/slaves/P1    - output directory for slave P1
/sim_projects/pro1/simProject/slaves/P2    - output directory for slave P2
/sim_projects/pro1/simProject/results/     - base directory for simulation results</pre>
</div>
</div>
<div class="paragraph">
<p>The base directory name, here <code>simProject</code> may be changed by using the <code>--working-directory</code> command line argument.</p>
</div>
<div class="sect3">
<h4 id="_directory_log">3.2.1. Directory <code>log</code></h4>
<div class="paragraph">
<p>This directory contains three files:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>progress.txt</code></dt>
<dd>
<p>contains overall simulation progress</p>
</dd>
<dt class="hdlist1"><code>screenlog.txt</code></dt>
<dd>
<p>contains the output of <em>MasterSim</em> written to the console window with the requested verbosity level (during initialization, always detailed output is written to the logfile, even if nothing is written on the screen due to low verbosity level)</p>
</dd>
<dt class="hdlist1"><code>summary.txt</code></dt>
<dd>
<p>after the simulation has completed <em>successfully</em>, this file contains a summary of the relevant solver/algorithm statistics.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The format of the <code>progress.txt</code> is fairly simple:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>   Simtime [s] 	   Realtime [s]	 Percentage [%]
            600	       0.000205	         0.0019
           1200	        0.00023	         0.0038
           1800	       0.000251	         0.0057
           2400	       0.000271	         0.0076
            ...             ...             ...</pre>
</div>
</div>
<div class="paragraph">
<p>The file has three columns, separated by a Tab character. The file is written and updated during the simulation run and can be used by other tools to pick up the overall progress and generate progress diagrams (speed/percentage etc.)</p>
</div>
<div class="paragraph">
<p>The meaning of the different values in the <code>summary.txt</code> are explained in section.</p>
</div>
</div>
<div class="sect3">
<h4 id="_directory_fmus">3.2.2. Directory <code>fmus</code></h4>
<div class="paragraph">
<p>Inside this directory, the imported FMUs are extracted, each in a subdirectory with basename of the FMU (<code>part1.fmu</code> &#8594; <code>part1</code>).</p>
</div>
<div class="paragraph">
<p>When a <em>MasterSim</em> project references several FMUs with same base name, which are for example in different subdirectories, then it will adjust the extraction path name. Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="python"><span class="n">slave1</span> <span class="p">:</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">fmus</span><span class="o">/</span><span class="n">s1</span><span class="o">.</span><span class="n">fmu</span>
<span class="n">slave2</span> <span class="p">:</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">fmus</span><span class="o">/</span><span class="n">s1</span><span class="o">.</span><span class="n">fmu</span>                <i class="conum" data-value="1"></i><b>(1)</b>
<span class="n">slave3</span> <span class="p">:</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">other</span><span class="o">/</span><span class="n">project</span><span class="o">/</span><span class="n">fmus</span><span class="o">/</span><span class="n">s1</span><span class="o">.</span><span class="n">fmu</span>     <i class="conum" data-value="2"></i><b>(2)</b>

<span class="c1"># _MasterSim_ generates directories
</span><span class="o">.../</span><span class="n">fmus</span><span class="o">/</span><span class="n">s1</span>
<span class="o">.../</span><span class="n">fmus</span><span class="o">/</span><span class="n">s1_2</span>                                <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>second instance of same FMU</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>different FMU with same basename</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>suffix 2 and 3 etc. is added by <em>MasterSim</em></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Basically, each <em>fmu</em> file is only extracted once.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<div class="title">Skipping the FMU extraction step</div>
<p>MasterSim provides the command line option <code>--skip-unzip</code>, that is very useful for fixing FMUs with errors in the <code>modelDescription.xml</code> or missing resources. If such an FMU is encountered, you can ran MasterSimulator once to extract the FMUs into the directory, then edit/adjust the bad files in the respective extraction directory and afterwards run the simulation again with <code>--skip-unzip</code>. <em>MasterSim</em> will now directly read the (modified) files and you can save yourself the hassle of zipping and renaming the FMU. Also, you can keep the <code>modelDescription.xml</code> opened in the editor and quickly iterate through the edit-and-test-run procedure, until everything works.</p>
</div>
<div class="paragraph">
<p>See also section <a href="#_modifyingfixing_fmu_content">Modifying/fixing FMU content</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_directory_slaves">3.2.3. Directory <code>slaves</code></h4>
<div class="paragraph">
<p>Often, non-trivial simulation slaves write their own output files, instead of pushing all output data via FMI output variables to the master. In cases, where PDEs are solved and many thousands of variables are generated, this may actually not be possible.</p>
</div>
<div class="paragraph">
<p>Since a slave FMU may be instantiated several times, hard-coding output paths inside the FMU is generally a bad idea (though still current practice). Also, writing outputs into the current working directory is not too smart either, since the working directory would have to be changed by the master between calls to FMUs, and this is best avoided.</p>
</div>
<div class="paragraph">
<p>Unfortunately, the FMU standard does not provide an option, to officially set such a result directory. <em>MasterSim</em> handles this by setting the slave-specific directory path in a string parameter named <code>ResultsRootDir</code>, if the FMU declares such a parameter. If there is no value set in the project file for this parameter, then <em>MasterSim</em> will set the path generated for the slave in the working directory. The FMU can rely on the path being created by <em>MasterSim</em> and being writable.
Of course, as with any parameter, you can set manually a value for this parameter.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_return_codes_of_mastersimulator_program">3.3. Return codes of <em>MasterSimulator</em> program</h3>
<div class="paragraph">
<p><em>MasterSimulator</em> returns:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
0
</td>
<td class="hdlist2">
<p>upon success</p>
</td>
</tr>
<tr>
<td class="hdlist1">
1
</td>
<td class="hdlist2">
<p>upon failure (anything from bad or missing FMUs, or errors during calculation, &#8230;&#8203;),  <code>screenlog.txt</code> will contain details.</p>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_simulation_output">3.4. Simulation output</h3>
<div class="sect3">
<h4 id="_slave_output_values">3.4.1. Slave output values</h4>
<div class="paragraph">
<p><em>MasterSim</em> creates two result files within the <code>results</code> subdirectory.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>values.csv</code></dt>
<dd>
<p>Number outputs of all output variables of all slaves (whether they are connected or not).</p>
</dd>
<dt class="hdlist1"><code>strings.csv</code></dt>
<dd>
<p>Values of all output variables of type string of all slaves.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>and depending on whether <em>synonymous variables</em> are defined in the ModelDescription (see below), the file <code>synonymous_variables.txt</code>.</p>
</div>
<div class="paragraph">
<p>String output files are only generated when outputs of this type are generated. CSV files use tab chars as separators. First column is always the time point, the column header indicates the time unit.</p>
</div>
<div class="paragraph">
<p>Example <code>values.csv</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Time [s] 	slave1.h [-] 	slave1.v [-]
0	1	0
0.001	0.999995099905	-0.0098100000000001
0.0019999999999999	0.99998038981	-0.019619999999999
0.0030000000000001	0.999955869715	-0.029430000000002
0.0040000000000002	0.99992153962	-0.039240000000001</pre>
</div>
</div>
<div class="paragraph">
<p>The file format corresponds to that of the csv-files used as FileReader-slaves, see section <a href="#_csv_filereader_slaves">CSV FileReader Slaves</a>, with:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>tabulator separated columns,</p>
</li>
<li>
<p>numbers written in english number format, and</p>
</li>
<li>
<p>a single header line identifying the variables.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The FMI variable names are prefixed with the corresponding slave name. The units are given in brackets and for unitless integer and boolean data types, the unit [-] is used.</p>
</div>
<div class="sect4">
<h5 id="_synonymous_variables">Synonymous variables</h5>
<div class="paragraph">
<p>Some FMUs (i.e. those generated from Modelica models) may have several (internal) variables that share the same value reference. This happens, when the symbolic analysis of the Modelica model has identified those variables as the same. In this case, MasterSim does not write duplicate output variables (would be a waste of harddrive space and simulation time, see ticket #47), but instead create a file <code>synonymous_variables.txt</code> with a table of synonymous variables.</p>
</div>
<div class="paragraph">
<p>The table is written as plain text file with tab-separated columns:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>fmu filename (currently, only the file name is written  - in case that the <em>same filename</em> with <em>different file paths</em> is being used, this may need to be changed)</p>
</li>
<li>
<p>the name of the variable that appears in the <code>values.csv</code> file</p>
</li>
<li>
<p>the synonymous variable, that is not written into the output file, since it has the same value anyway</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Example for <code>synonymous_variables.txt</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>ControlledTemperature.fmu	heatCapacitor.T	heatCapacitor.port.T
ControlledTemperature.fmu	heatCapacitor.T	heatingResistor.T_heatPort
ControlledTemperature.fmu	heatCapacitor.T	heatingResistor.heatPort.T
ControlledTemperature.fmu	heatCapacitor.T	temperatureSensor.port.T
ControlledTemperature.fmu	heatCapacitor.T	thermalConductor.port_a.T
ControlledTemperature.fmu	heatingResistor.p.v	heatingResistor.v
ControlledTemperature.fmu	heatingResistor.p.v	idealSwitch.n.v
ControlledTemperature.fmu	constantVoltage.i	constantVoltage.n.i
ControlledTemperature.fmu	constantVoltage.i	constantVoltage.p.i
ControlledTemperature.fmu	constantVoltage.i	heatingResistor.i
ControlledTemperature.fmu	constantVoltage.i	heatingResistor.n.i
ControlledTemperature.fmu	constantVoltage.i	heatingResistor.p.i
ControlledTemperature.fmu	constantVoltage.i	idealSwitch.i
ControlledTemperature.fmu	constantVoltage.i	idealSwitch.n.i
ControlledTemperature.fmu	constantVoltage.i	idealSwitch.p.i
ControlledTemperature.fmu	heatingResistor.LossPower	heatingResistor.heatPort.Q_flow
ControlledTemperature.fmu	fixedTemperature.port.Q_flow	thermalConductor.Q_flow
ControlledTemperature.fmu	fixedTemperature.port.Q_flow	thermalConductor.port_a.Q_flow
ControlledTemperature.fmu	fixedTemperature.port.Q_flow	thermalConductor.port_b.Q_flow
ControlledTemperature.fmu	onOffController.reference	ramp.y
ControlledTemperature.fmu	onOffController.u	temperatureSensor.T
ControlledTemperature.fmu	idealSwitch.control	logicalNot.y
ControlledTemperature.fmu	logicalNot.u	onOffController.y</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_final_statisticssummary">3.4.2. Final statistics/summary</h4>
<div class="paragraph">
<p><em>MasterSim</em> contains internal profiling functions that monitor the evaluation times of various parts of the software. Also, execution counts for different critical functions are shown.</p>
</div>
<div class="paragraph">
<p>The statistics is printed on the console window (for verbosity level &gt; 0) and in the log file <code>screenlog.txt</code> in the following format:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Solver statistics
------------------------------------------------------------------------------
Wall clock time                            =   78.044 ms
------------------------------------------------------------------------------
Output writing                             =   76.767 ms
Master-Algorithm                           =    0.666 ms         324
Convergence failures                       =                      41
Convergence iteration limit exceeded       =                      41
Error test time and failure count          =    0.214 ms          85
------------------------------------------------------------------------------
Part1                               doStep =    0.101 ms        1229
                                  getState =    0.070 ms        1116
                                  setState =    0.020 ms         509
Part2                               doStep =    0.079 ms        1496
                                  getState =    0.039 ms        1116
                                  setState =    0.024 ms         776
Part3                               doStep =    0.071 ms        1496
                                  getState =    0.038 ms        1116
                                  setState =    0.040 ms         776
------------------------------------------------------------------------------</pre>
</div>
</div>
<div class="paragraph">
<p>Also, the same statistics information is printed into the <code>summary.txt</code> log file, in a more <em>machine-friendly</em> format (with timings always in <strong>seconds</strong>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>WallClockTime=0.078044
FrameworkTimeWriteOutputs=0.076767
MasterAlgorithmSteps=324
MasterAlgorithmTime=0.000666
ConvergenceFails=41
ConvergenceIterLimitExceeded=41
ErrorTestFails=85
ErrorTestTime=0.000214
Slave[1]Time=0.000191
Slave[2]Time=0.000142
Slave[3]Time=0.000149</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Wall clock time</dt>
<dd>
<p>total simulation time spend after initialization. Time for unzipping and loading of shared libraries is excluded (<code>WallClockTime</code>).</p>
</dd>
<dt class="hdlist1">Output writing</dt>
<dd>
<p>time spent in writing output files and computing values related to such outputs (<code>FrameworkTimeWriteOutputs</code>)</p>
</dd>
<dt class="hdlist1">Master-Algorithm</dt>
<dd>
<p>Time spent in the actual master algorithm (<code>MasterAlgorithmTime</code>) and number of calls to the algorithm and overall time steps taken (<code>MasterAlgorithmSteps</code>)</p>
</dd>
<dt class="hdlist1">Convergence failures</dt>
<dd>
<p>Number of times an iterative master algorithm failed to converge within the allowed number of iterations or diverged. Only applies to iterative master algorithms (<code>ConvergenceFails</code>)</p>
</dd>
<dt class="hdlist1">Convergence iteration limit exceeded</dt>
<dd>
<p>Number of times an iterative master algorithm failed to converge within the allowed number of iterations (should be less or equal to convergence failure count). Only applies to iterative master algorithms (<code>ConvergenceIterLimitExceeded</code>)</p>
</dd>
<dt class="hdlist1">Error test time and failure count</dt>
<dd>
<p>Number of times the error test failed (<code>ErrorTestFails</code>) and overall time needed for performing error tests, including the time for resetting FMU states and re-evaluating steps (<code>ErrorTestTime</code>). Only applies to master algorithms with enabled error control (Richardson-variants).</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The remaining lines show timings and counters for each slave individually.  This lines show the time taken in the function calls to <code>doStep()</code>, <code>getState()</code> and <code>setState()</code> for this slave and the respective call count. The state-related functions are only used by iterative master algorithms, when the FMUs support FMI 2.0 features. Mind, these functions are called both by the master algoritm and by the error test (if enabled).</p>
</div>
<div class="paragraph">
<p><strong>Output writing</strong> and <strong>Master-Algorithm</strong> are the major two components of the MasterSimulator program, so there times should sum up close to the total wall clock time.</p>
</div>
<div class="paragraph">
<p>The third column in the screenlog-statistics contains counters. The counter for Master-Algorithm is the number of times the master algorithm takes a step, so that&#8217;s the total step count. Re-tries and iterations <em>within</em> the master algorithm are not counted here.</p>
</div>
<div class="paragraph">
<p>The last section of the statistics lists timings and counters for individual FMU slaves and the most relevant functions.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You may use these profiling values to tune your simulation and identify, in case of very slow simulations, which of the FMUs is taking up most of the time. Also, it helps identifying if one of the fast functions (get and set state) are taking way too much time.</p>
</div>
</td>
</tr>
</table>
</div>
<hr>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_project_file_format">4. Project file format</h2>
<div class="sectionbody">
<div class="paragraph">
<p><em>MasterSim</em> uses a single project file that describes a simulation scenario. This project file has the extension <code>msim</code> and contains all data to perform a simulation.</p>
</div>
<div class="paragraph">
<p>A second file with same name and extension <code>bm</code> may be present in the same location as the project file. This contains the graphical representation of the simulation scenario. Since the graphical network display is <em>purely optional</em>, the <code>bm</code> file can be omitted/ignored/deleted at will.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<div class="title">Future development work</div>
<p>Currently, research is underway within the Modelica Association Project SSP <a href="https://modelica.org/projects">System Structure and Parameterization of Components for Virtual System Design</a> to define a standard for describing simulation scenarios. In due time, when the specs are complete enough, this master simulator may support this file standard, at least for exporting and importing such data. Such a file actually merges description of the FMU connection topology and its (still optional) graphical representation into one file. However, similar to FMUs this file format is actually a zip-compressed folder structure and hence SSP-project files may no longer effectively been used in version control systems. Here, the ASCII format of the current <code>msim</code> and <code>bm</code> files is very convenient and useful.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The format is a plain-text format (UTF8-encoded) with the following content:</p>
</div>
<div class="listingblock">
<div class="title">Example MasterSim project file</div>
<div class="content">
<pre># Created:	Di. Aug. 14 17:02:20 2018
# LastModified:	Di. Aug. 14 17:02:20 2018

# Project file example for iterating GaussSeidel with time step adjustment
#
# No error test included, time step adjustment based on convergence failures.
tStart                   0 s
tEnd                     12 s
hMax                     30 min
hMin                     1e-06 s
hFallBackLimit           0.001 s
hStart                   1e-07 s
hOutputMin               0.12 s
adjustStepSize           no
preventOversteppingOfEndTime yes
absTol                   1e-06
relTol                   0.01
MasterMode               GAUSS_JACOBI
ErrorControlMode         NONE
maxIterations            1
writeInternalVariables   yes

simulator 0 0 Part1 #ff447cb4 "fmus/simx/Part1.fmu"
simulator 1 1 Part2 #ffc38200 "fmus/simx/Part2.fmu"
simulator 2 1 Part3 #ffff0000 "fmus/simx/Part3.fmu"

graph Part1.x2 Part2.x2
graph Part1.x1 Part2.x1
graph Part2.x3 Part3.x3
graph Part3.x4 Part2.x4

parameters Part1.para1  14.3</pre>
</div>
</div>
<div class="paragraph">
<p>Each line defines a different property. Tokens in each line are separated by whitespaces (tabs or spaces). Lines beginning with a hash character # are comment and ignored.</p>
</div>
<div id="screenshot_project_properties" class="imageblock">
<div class="content">
<img src="./images/welcome_page_project_properties.png" alt="Project properties shown on the welcome page">
</div>
<div class="title">Figure 11. Project properties shown on the welcome page</div>
</div>
<div class="paragraph">
<p>All comment lines before the first actual input line are recognized as the header lines. In these lines the keywords <code>Created:</code> and <code>LastModified:</code> are expected to be followed by a more or less meaningful (but not standardized) date/time string to be shown in the user interface. Other header lines are treated as project description, show in the project summary on the welcome page of the graphical user interface (see Figure <a href="#screenshot_project_properties">Project properties shown on the welcome page</a>).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Past the header with the description, the order of the entries/lines in the file is arbitrary.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_simulator_settings">4.1. Simulator settings</h3>
<div class="paragraph">
<p>Below is a short description of the different parameters with a format description and what values are needed. For details on where there are used and what influence they have, see section <a href="#_master_algorithms">Master Algorithms</a>.</p>
</div>
<div class="paragraph">
<p>Parameters are given as numbers followed by a unit, except for counters (iteration limit) or tolerances (which are unitless anyway).</p>
</div>
<div class="paragraph">
<p>Time step related options:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
tStart
</td>
<td class="hdlist2">
<p>(<em>default=0 s</em>) start time point of simulation</p>
</td>
</tr>
<tr>
<td class="hdlist1">
tEnd
</td>
<td class="hdlist2">
<p>(<em>default=1 a</em>) end time of simulation, must be &gt; <strong>tStart</strong></p>
</td>
</tr>
<tr>
<td class="hdlist1">
hMax
</td>
<td class="hdlist2">
<p>(<em>default=30 min</em>) maximum time step size</p>
</td>
</tr>
<tr>
<td class="hdlist1">
hMin
</td>
<td class="hdlist2">
<p>(<em>default=1e-5 s</em>) lower limit of time step in adaptive-time-step mode, if time step is reduced below this limit, master stops</p>
</td>
</tr>
<tr>
<td class="hdlist1">
hFallBackLimit
</td>
<td class="hdlist2">
<p>(<em>default=1e-3 s</em>) for Gauss-Seidel with time step adjustment: when time step drops below this limit, non-iterating Gauss-Seidel is used (to compensate for discontinous outputs), should be &gt; <strong>hMin</strong></p>
</td>
</tr>
<tr>
<td class="hdlist1">
hStart
</td>
<td class="hdlist2">
<p>(<em>default=10 min</em>) initial time step, will be use as constant step size when not in adaptive-time-step mode.</p>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If <strong>hStart</strong> is set to 0 in the project file, it will be computed to be 1/1000 of the simulation duration defined by (<strong>tEnd - tStart</strong>).
</td>
</tr>
</table>
</div>
</td>
</tr>
<tr>
<td class="hdlist1">
hOutputMin
</td>
<td class="hdlist2">
<p>(<em>default=10 min</em>) minimim time that need to elapse before next output values are written, if communication step sizes are larger than <strong>hOutputMin</strong>, outputs may be skipped but the regular output intervals will be kept</p>
</td>
</tr>
<tr>
<td class="hdlist1">
outputTimeUnit
</td>
<td class="hdlist2">
<p>(<em>default=s</em>) The unit to be used in for the time column (the first column) of output files</p>
</td>
</tr>
<tr>
<td class="hdlist1">
adjustStepSize
</td>
<td class="hdlist2">
<p>(<em>default=false</em>) enables/disables adaptive-time-step mode, when error control mode is <strong>ADAPT_STEP</strong>, disablin <strong>adjustStepSize</strong> is an error</p>
</td>
</tr>
<tr>
<td class="hdlist1">
preventOversteppingOfEndTime
</td>
<td class="hdlist2">
<p>This flag is needed for certain FMUs, which include a test against surpassing the end simulation time. This is in some cases related to time series parameters, that only last until exactly the simulation end time. Another problem is also, that rounding errors can add to a very small overshooting of the end time point. Nevertheless, well-behaving FMUs should handle overstepping gracefully. Yet, to avoid an FMU error and abort of the simulation, <em>MasterSim</em> can adjust the last communcation interval&#8217;s size such, that exactly the end time of the simulation is given to the FMU. If this flag is enabled, the last interval&#8217;s step size may be adjusted, even though time step adjustment is generally disabled by flag <strong>adjustStepSize</strong>.</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>MasterMode</strong> (<em>default=GAUSS_SEIDEL</em>) is one of:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
GAUSS_JACOBI
</td>
<td class="hdlist2">
<p>Gauss-Jacobi algorithm (non-iterative)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
GAUSS_SEIDEL
</td>
<td class="hdlist2">
<p>Gauss-Seidel algorithm (iterative or non-iterative depending on <strong>it_max_steps</strong>)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
NEWTON
</td>
<td class="hdlist2">
<p>Newton algorithm with difference-quotient approximation to Jacobi matrix</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Iteration and convergence parameters:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
maxIterations
</td>
<td class="hdlist2">
<p>(<em>default=1=disabled</em>) max. number of iterations, if == 1 no iteration is done</p>
</td>
</tr>
<tr>
<td class="hdlist1">
absTol
</td>
<td class="hdlist2">
<p>(<em>default=1e-5</em>) absolute tolerance for convergence/error test</p>
</td>
</tr>
<tr>
<td class="hdlist1">
relTol
</td>
<td class="hdlist2">
<p>(<em>default=1e-6</em>) relative tolerance for convergence/error test</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>ErrorControlMode</strong> (<em>default=NONE=disabled</em>) is one of:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
NONE
</td>
<td class="hdlist2">
<p>no error checking and adjustment</p>
</td>
</tr>
<tr>
<td class="hdlist1">
CHECK
</td>
<td class="hdlist2">
<p>- only error checking, protocols time and magnitude of exceeded error limit. Also works with FMI 1 (by using the data of the last two steps).</p>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Not implemented, yet. Do not use!
</td>
</tr>
</table>
</div>
</td>
</tr>
<tr>
<td class="hdlist1">
ADAPT_STEP
</td>
<td class="hdlist2">
<p>implicitely enables adaptive-time-step mode and adjusts time step when error limit is exceeded</p>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_advanced_settings">4.1.1. Advanced settings</h4>
<div class="paragraph">
<p>The following settings are mostly needed for use with cross-check procedure.</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
preventOversteppingOfEndTime
</td>
<td class="hdlist2">
<p>(<em>default=true</em>) even for constant-step FMUs, truncate the final step to hit the end time point exactly (needed for some FMUs who have strict end time checking)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
writeInternalVariables
</td>
<td class="hdlist2">
<p>(<em>default=false</em>) Also writes variables with local/internal causality (when set to <strong>no</strong>, only variables with causality <em>output</em> are written)</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Depending on the selected options, certain capabilities must be supported by the FMUs, see section <a href="#_master_algorithms">Master Algorithms</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_simulatorslave_definitions">4.2. Simulator/Slave Definitions</h3>
<div class="paragraph">
<p>Each slave is defined by:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>simulator  &lt;priority&gt; &lt;cycle&gt;  &lt;slave-name&gt; &lt;html-color-code&gt; &lt;path/to/fmu-file&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>The <strong>cycle</strong> indicates whether slave belongs to a cycle with other FMUs. <strong>slave-name</strong> must be a unique identifier for the slave (see discussion in section <a href="#_master_algorithms">Master Algorithms</a>).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <strong>priority</strong> is used to select order of execution within a cycle (for Gauss-Seidel). However, this feature is currently not implemented and slaves within the same cycle are evaluated in the order they are defined.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The slave/simulator name is a unique identifier of the FMU instance.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Slave names <strong>must not</strong> contain spaces or dots. If a slave name contains a space or a dot, the parser of the project file will state that the simulator definition line is invalid. Also, slave names are used for directory names (target directories for slave-specific output). Hence, they must not contain characters that are not allowed in file system names.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <strong>html-color-code</strong> is a typical html color definition, beginning with a hash character and then either 8 or 6 characters, for example: <code>#ff00ff00</code> or <code>#00ff00</code> for green. In the 8 character format, the first hex number is the alpha value (opaqueness - ff = fully opaque, 0 = fully transparent). Currently, there is no use for this value in the user interface, so the 6 character variant is the typical choice.</p>
</div>
<div class="paragraph">
<p>Last argument in the line is the file path reference to the actual FMU file. The path to FMU file must be enclosed in double-quotes, if the path or filename contains spaces. The path can be absolute or relative to the <code>msim</code> project file. Several slaves can be instantiated from the same FMU file (if the FMU supports this feature). In this case, several simulator lines reference the same FMU file path.</p>
</div>
<div class="sect3">
<h4 id="_csv_filereader_slaves">4.2.1. CSV FileReader Slaves</h4>
<div class="paragraph">
<p>Instead of an FMU, you can also reference a data file (extension <code>tsv</code> or <code>csv</code>). In this case, <em>MasterSim</em> will instantiate FileReader slaves and the data in the file is treated like an FMU that provides only output, but has no input and no parameters.</p>
</div>
<div class="paragraph">
<p><em>MasterSim</em> actually supports two flavours of csv files. In both variants, numbers are always written in <strong>english number notation</strong>. The file parser first attempts to use the tab-separated value flavour by splitting the first two lines at the tab characters. If this yields more than two columns and the same nummber of columns in both lines (the header and first data line), a tab-separated csv/tsv flavour is assumed. Otherwise, the Excel-type quoted-csv flavour is assumed.</p>
</div>
<div class="sect4">
<h5 id="_tab_separated_values">Tab-separated values</h5>
<div class="paragraph">
<p>The format of such an input file follows the same conventions as the file format supported by <a href="https://bauklimatik-dresden.de/postproc">PostProc2</a>.</p>
</div>
<div class="paragraph">
<p>The file starts with a single line (the header), identifying variable name and unit in format like:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Time [&lt;time unit&gt;] &lt;tab&gt; &lt;var1 name&gt; [&lt;unit&gt;] &lt;tab&gt; &lt;var2 name&gt; [&lt;unit&gt;]</pre>
</div>
</div>
<div class="paragraph">
<p>where <code>&lt;tab&gt;</code> is the tabulator character.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Time [d]  &lt;tab&gt;  T_lab [C]  &lt;tab&gt;  T_sample [C]  &lt;tab&gt;  RH_lab [%]</pre>
</div>
</div>
<div class="paragraph">
<p>Example file:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Time [h]     T_lab [C]     T_sample [C]     RH_lab [%]
0            20            20.2             46
0.5          20.1          20.3             43
1.0          22            25               40
3.0          19            15               65</pre>
</div>
</div>
<div class="paragraph">
<p>The variable names are the strings in the header line excluding the units (if given). In the example above, the file would provide output variables of with names <strong>T_lab</strong>, <strong>T_sample</strong> and <strong>TH_lab</strong>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>A file with this format is automatically obtained if a table with such data is copied &amp; pasted from Libreoffice-Calc/Excel/&#8230;&#8203; into a plain text editor.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_comma_separated_with_quotes">Comma-separated with quotes</h5>
<div class="paragraph">
<p>In such a file the separation character is the , (comma), and values are quoted using double-quotes. For example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>"time","T_lab [C]","T_sample [C]","RH_lab [%]"
"0","20","20.2","46"
"0.5","20.1","20.3","43"
"1.0","22","25","40"</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_time_points_and_time_unit">4.2.2. Time points and time unit</h4>
<div class="paragraph">
<p>The time points can be spaced at arbitrary intervals. <em>MasterSim</em> currently expects simulations to run in seconds as base time unit. That means, internally, variables are exchanged matching a simulation time in seconds. When an input file defines a different unit for time, <em>MasterSim</em> converts these times into seconds.</p>
</div>
<div class="paragraph">
<p>The following time units are recognized by MasterSim:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ms - milliseconds</p>
</li>
<li>
<p>s - seconds</p>
</li>
<li>
<p>min - minutes</p>
</li>
<li>
<p>h - hours</p>
</li>
<li>
<p>d - days</p>
</li>
<li>
<p>a - years (regular years, 365 regular days, no leap year/day)</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<div class="title">Default time unit is seconds</div>
<p>In case of missing time unit in the header of the first column, <em>MasterSim</em> currently implies unit <strong>seconds</strong> (s).</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_interpretation_of_data_provided_in_filereader_slaves">4.2.3. Interpretation of data provided in FileReader slaves</h4>
<div class="paragraph">
<p>Variables without given units, i.e. the [&#8230;&#8203;] is missing in the column captions, are assigned an unknown/undefined unit <em>-</em>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The variables exported from such a FileReader slave have not yet data types assigned. During the initialization, <em>MasterSim</em> looks at the connections made to FileReader slave variables and assigns data types to the variables based on the <em>connected input variable</em>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>During simulation, when the FileReader slave is asked to provide a value for a variable, the following rules apply.</p>
</div>
<div class="sect4">
<h5 id="_boolean_integer_and_enumeration_values"><strong>Boolean</strong>, <strong>Integer</strong> and <strong>Enumeration</strong> values</h5>
<div class="paragraph">
<p>For <strong>Boolean</strong>, <strong>Integer</strong> and <strong>Enumeration</strong> values no interpolation is done. Values are returned constant until the value is defined to change. Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Time [s]   Value [-]
 1         4
 3         4 <i class="conum" data-value="1"></i><b>(1)</b>
 3         7 <i class="conum" data-value="2"></i><b>(2)</b>
 6         4</pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Value at end of interval ending at time 3</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Value at begin of interval beginning at time 3, this value shall be used from t&gt;=3.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Evaluation of these values yields:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>v(1) = 4
v(2) = 4
v(2.99999) = 4
v(3) = 7
v(4) = 7
v(5.99999) = 7
v(6) = 4</pre>
</div>
</div>
<div class="paragraph">
<p>Thus, the line <code>3     4</code> could have been omitted from the file.</p>
</div>
</div>
<div class="sect4">
<h5 id="_real_values">Real values</h5>
<div class="paragraph">
<p><strong>Real</strong> values are linearly interpolated. For the data example above, real values would be evaluated as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre> v(1) = 4
 v(2) = 4
 v(2.99999) = 6.99999 <i class="conum" data-value="1"></i><b>(1)</b>
 v(3) = 7
 v(4) = 6 <i class="conum" data-value="2"></i><b>(2)</b>
 v(5.99999) = 4.00001
 v(6) = 4</pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>When duplicate time points are found, the second overwrites the first, so that the line <code>3   4</code> is ignored. Hence, evaluation of values in the interval 2&#8230;&#8203;3 is also done with linear interpolation.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The linear interpolation between values v(3)=7 and v(6)=4 at t=4 yields 6.</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you want to emulate step functions with <strong>Real</strong> values, just use a very short change interval, for example <code>v(1) = 4; v(2.9999) = 4; v(3) = 7</code>. <em>MasterSim</em> will still see the linear slope between t=2.9999 and 3, but that may be insignificant to the results.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Naturally, for <strong>string</strong> parameters linear interpolation is not possible, thus they are handled similarly as <strong>integer</strong> values.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you use an adaptive step algorithm in <em>MasterSim</em>, you should set the maximum time step/communication interval length to a value that is less than your smallest time interval in your FileReader slave input file. Otherwise, <em>MasterSim</em> may adjust time steps to a larger value and jump over an interval/value, hereby missing information and likely generating wrong results. For example: if you work with hourly climatic data, choose 30 minutes as maximum communication interval length.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_connection_graph">4.3. Connection graph</h3>
<div class="paragraph">
<p>The connection graph defines data exchange between slaves. Each graph definition line defines the data transfer from one output variable to one input variable.</p>
</div>
<div class="paragraph">
<p>Definition syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>graph &lt;outputvar&gt; &lt;inputvar&gt; [&lt;offset&gt; &lt;scale factor&gt;]</pre>
</div>
</div>
<div class="paragraph">
<p>Output and input variables are composed of slave name and variable name:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>graph &lt;slave-name&gt;.&lt;variable-name&gt; &lt;slave-name&gt;.&lt;variable-name&gt;  [&lt;offset&gt; &lt;scale factor&gt;]</pre>
</div>
</div>
<div class="paragraph">
<p>The offset and scale factor define a transformation operation between the output variable and the value given to the input variable. If such a transformation is assigned to a connection, always both values must be present.</p>
</div>
<div class="paragraph">
<p>The following transformation equation is applied:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>input = offset + scale * output</pre>
</div>
</div>
<div class="paragraph">
<p>If, for example, an FMU slave <em>Sensor</em> delivers a temperature in Kelvin, and another FMU slave <em>Heater</em> takes a temperature in degree Celsius, you could define the connection as follows:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>graph  Sensor.temperature  Heater.temperature  -273.15  1</pre>
</div>
</div>
<div class="paragraph">
<p>which will result in</p>
</div>
<div class="literalblock">
<div class="content">
<pre>input (in C) = -273.15 + 1 * output (in K)</pre>
</div>
</div>
<div class="paragraph">
<p>Similarly, you can invert the sign of a connection, when you, for example, connect heat or mass flows across pipes. Suppose heat flow is defined positively into a surface and you connect <em>SurfaceA.HeatFlow</em> and <em>SurfaceB.HeatFlow</em>, the connection with sign inversion is defined as:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>graph  SurfaceA.HeatFlow  SurfaceB.HeatFlow  0  -1</pre>
</div>
</div>
<div class="sect3">
<h4 id="_fmu_parameters">4.3.1. FMU Parameters</h4>
<div class="paragraph">
<p>You can set parameters of FMUs (or more specifically of the individual FMU slaves/instances) by using the <code>parameter</code> keyword.</p>
</div>
<div class="paragraph">
<p>Definition syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>parameter &lt;slave-name&gt;.&lt;variable-name&gt; &lt;value&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>For <strong>boolean</strong> parameters you have to specify <code>true</code> (case-sensitive!) for <strong>true</strong>, or any other value (for example <code>false</code>) for <strong>false</strong>.</p>
</div>
<div class="paragraph">
<p>For <strong>integer</strong> values you specify simply the value as number.</p>
</div>
<div class="paragraph">
<p>Values for <strong>Real</strong> parameters are expected in the unit defined for the respective parameter in the <code>modelDescription.xml</code> file. Unit conversion is <strong>not</strong> supported here.</p>
</div>
<div class="paragraph">
<p>For <strong>string</strong> parameters, everything after the variable name is taken as string (until end of line). Example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>parameter building_model.projectFile C:\\My projects\\p2\\This tall building.project</pre>
</div>
</div>
<div class="paragraph">
<p>Whitespaces can be included, but backspaces need to be encoded as <code>\\</code>. Line breaks have to be encoded with <code>\n</code>, as in the following example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>parameter building_model.configPara First line\n    Some more lines with indentation\nlast line.</pre>
</div>
</div>
<div class="paragraph">
<p>Will set the string:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>First line
    Some more lines with indentation
last line</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Because of the rather simple string encoding, you cannot define a string that starts with a whitespace character.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_blockmod_network_representation_file_format">4.4. BlockMod - Network Representation File Format</h3>
<div class="paragraph">
<p>The <code>bm</code> file is a simple xml file and describes the graphical layout and visualization of the modeled simulation scenario.</p>
</div>
<div class="paragraph">
<p>A simple network like</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/bm_network_example.png" alt="Blockmod Network Example">
</div>
<div class="title">Figure 12. Example for a simple graphical representation of a network</div>
</div>
<div class="paragraph">
<p>is defined in the following BlockMod network representation file:</p>
</div>
<div class="listingblock">
<div class="title">Blockmod network representation file</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;BlockMod&gt;</span>
	<span class="c">&lt;!--Blocks--&gt;</span>
	<span class="nt">&lt;Blocks&gt;</span>
		<span class="nt">&lt;Block</span> <span class="na">name=</span><span class="s">"Part2"</span><span class="nt">&gt;</span>
			<span class="nt">&lt;Position&gt;</span>224, -160<span class="nt">&lt;/Position&gt;</span>
			<span class="nt">&lt;Size&gt;</span>64, 64<span class="nt">&lt;/Size&gt;</span>
			<span class="c">&lt;!--Sockets--&gt;</span>
			<span class="nt">&lt;Sockets&gt;</span>
				<span class="nt">&lt;Socket</span> <span class="na">name=</span><span class="s">"x1"</span><span class="nt">&gt;</span>
					<span class="nt">&lt;Position&gt;</span>0, 16<span class="nt">&lt;/Position&gt;</span>
					<span class="nt">&lt;Orientation&gt;</span>Horizontal<span class="nt">&lt;/Orientation&gt;</span>
					<span class="nt">&lt;Inlet&gt;</span>true<span class="nt">&lt;/Inlet&gt;</span>
				<span class="nt">&lt;/Socket&gt;</span>
				<span class="nt">&lt;Socket</span> <span class="na">name=</span><span class="s">"x2"</span><span class="nt">&gt;</span>
					<span class="nt">&lt;Position&gt;</span>0, 32<span class="nt">&lt;/Position&gt;</span>
					<span class="nt">&lt;Orientation&gt;</span>Horizontal<span class="nt">&lt;/Orientation&gt;</span>
					<span class="nt">&lt;Inlet&gt;</span>true<span class="nt">&lt;/Inlet&gt;</span>
				<span class="nt">&lt;/Socket&gt;</span>
				<span class="nt">&lt;Socket</span> <span class="na">name=</span><span class="s">"x4"</span><span class="nt">&gt;</span>
					<span class="nt">&lt;Position&gt;</span>0, 48<span class="nt">&lt;/Position&gt;</span>
					<span class="nt">&lt;Orientation&gt;</span>Horizontal<span class="nt">&lt;/Orientation&gt;</span>
					<span class="nt">&lt;Inlet&gt;</span>true<span class="nt">&lt;/Inlet&gt;</span>
				<span class="nt">&lt;/Socket&gt;</span>
				<span class="nt">&lt;Socket</span> <span class="na">name=</span><span class="s">"x3"</span><span class="nt">&gt;</span>
					<span class="nt">&lt;Position&gt;</span>64, 16<span class="nt">&lt;/Position&gt;</span>
					<span class="nt">&lt;Orientation&gt;</span>Horizontal<span class="nt">&lt;/Orientation&gt;</span>
					<span class="nt">&lt;Inlet&gt;</span>false<span class="nt">&lt;/Inlet&gt;</span>
				<span class="nt">&lt;/Socket&gt;</span>
			<span class="nt">&lt;/Sockets&gt;</span>
		<span class="nt">&lt;/Block&gt;</span>
		<span class="nt">&lt;Block</span> <span class="na">name=</span><span class="s">"Part3"</span><span class="nt">&gt;</span>
			<span class="nt">&lt;Position&gt;</span>352, -160<span class="nt">&lt;/Position&gt;</span>
			<span class="nt">&lt;Size&gt;</span>96, 32<span class="nt">&lt;/Size&gt;</span>
			<span class="c">&lt;!--Sockets--&gt;</span>
			<span class="nt">&lt;Sockets&gt;</span>
				<span class="nt">&lt;Socket</span> <span class="na">name=</span><span class="s">"x3"</span><span class="nt">&gt;</span>
					<span class="nt">&lt;Position&gt;</span>0, 16<span class="nt">&lt;/Position&gt;</span>
					<span class="nt">&lt;Orientation&gt;</span>Horizontal<span class="nt">&lt;/Orientation&gt;</span>
					<span class="nt">&lt;Inlet&gt;</span>true<span class="nt">&lt;/Inlet&gt;</span>
				<span class="nt">&lt;/Socket&gt;</span>
				<span class="nt">&lt;Socket</span> <span class="na">name=</span><span class="s">"x4"</span><span class="nt">&gt;</span>
					<span class="nt">&lt;Position&gt;</span>96, 16<span class="nt">&lt;/Position&gt;</span>
					<span class="nt">&lt;Orientation&gt;</span>Horizontal<span class="nt">&lt;/Orientation&gt;</span>
					<span class="nt">&lt;Inlet&gt;</span>false<span class="nt">&lt;/Inlet&gt;</span>
				<span class="nt">&lt;/Socket&gt;</span>
			<span class="nt">&lt;/Sockets&gt;</span>
		<span class="nt">&lt;/Block&gt;</span>
	<span class="nt">&lt;/Blocks&gt;</span>
	<span class="c">&lt;!--Connectors--&gt;</span>
	<span class="nt">&lt;Connectors&gt;</span>
		<span class="nt">&lt;Connector</span> <span class="na">name=</span><span class="s">"new connector"</span><span class="nt">&gt;</span>
			<span class="nt">&lt;Source&gt;</span>Part2.x3<span class="nt">&lt;/Source&gt;</span>
			<span class="nt">&lt;Target&gt;</span>Part3.x3<span class="nt">&lt;/Target&gt;</span>
			<span class="c">&lt;!--Connector segments (between start and end lines)--&gt;</span>
			<span class="nt">&lt;Segments&gt;</span>
				<span class="nt">&lt;Segment&gt;</span>
					<span class="nt">&lt;Orientation&gt;</span>Horizontal<span class="nt">&lt;/Orientation&gt;</span>
					<span class="nt">&lt;Offset&gt;</span>0<span class="nt">&lt;/Offset&gt;</span>
				<span class="nt">&lt;/Segment&gt;</span>
			<span class="nt">&lt;/Segments&gt;</span>
		<span class="nt">&lt;/Connector&gt;</span>
		<span class="nt">&lt;Connector</span> <span class="na">name=</span><span class="s">"auto-named"</span><span class="nt">&gt;</span>
			<span class="nt">&lt;Source&gt;</span>Part3.x4<span class="nt">&lt;/Source&gt;</span>
			<span class="nt">&lt;Target&gt;</span>Part2.x4<span class="nt">&lt;/Target&gt;</span>
			<span class="c">&lt;!--Connector segments (between start and end lines)--&gt;</span>
			<span class="nt">&lt;Segments&gt;</span>
				<span class="nt">&lt;Segment&gt;</span>
					<span class="nt">&lt;Orientation&gt;</span>Vertical<span class="nt">&lt;/Orientation&gt;</span>
					<span class="nt">&lt;Offset&gt;</span>80<span class="nt">&lt;/Offset&gt;</span>
				<span class="nt">&lt;/Segment&gt;</span>
				<span class="nt">&lt;Segment&gt;</span>
					<span class="nt">&lt;Orientation&gt;</span>Horizontal<span class="nt">&lt;/Orientation&gt;</span>
					<span class="nt">&lt;Offset&gt;</span>-288<span class="nt">&lt;/Offset&gt;</span>
				<span class="nt">&lt;/Segment&gt;</span>
				<span class="nt">&lt;Segment&gt;</span>
					<span class="nt">&lt;Orientation&gt;</span>Vertical<span class="nt">&lt;/Orientation&gt;</span>
					<span class="nt">&lt;Offset&gt;</span>-48<span class="nt">&lt;/Offset&gt;</span>
				<span class="nt">&lt;/Segment&gt;</span>
			<span class="nt">&lt;/Segments&gt;</span>
		<span class="nt">&lt;/Connector&gt;</span>
	<span class="nt">&lt;/Connectors&gt;</span>
<span class="nt">&lt;/BlockMod&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The format is pretty self-explanatory. The first and last segment are defined automatically depending on the socket position on the block and are hence not stored in the network representation file.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p><a href="https://github.com/ghorwin/BlockMod">BlockMod</a> is an open source library for modeling such networks. The wiki page of the project contains more in-depth information on the data format and functionality.</p>
</div>
</td>
</tr>
</table>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_test_suite_concept">5. Test Suite Concept</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <em>MasterSim</em> repository includes a subdirectory <code>data/tests</code> with a regression test suite. These tests are used to check whether all algorithms work as expected and whether changes in the code base accidentally break something.</p>
</div>
<div class="paragraph">
<p><em>MasterSim</em> is also run through the FMI cross-checking tests. The files and scripts related to those tests are in the subdirectory <code>cross-check</code>.</p>
</div>
<div class="sect2">
<h3 id="_regression_tests">5.1. Regression tests</h3>
<div class="sect3">
<h4 id="_directory_structure">5.1.1. Directory structure</h4>
<div class="literalblock">
<div class="content">
<pre>/data/tests                     - root directory for tests
/data/tests/&lt;platform&gt;/&lt;test&gt;   - base directory for a test suite</pre>
</div>
</div>
<div class="paragraph">
<p><code>platform</code> is (currently) one of: <code>linux64</code>, <code>win32</code>,<code>win64</code> and <code>darwin64</code></p>
</div>
<div class="paragraph">
<p>Each <em>test suite</em> has a set of subdirectories:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>fmus                 - holds fmu archives needed for the test
description          - (mathematical) description of the test problem</pre>
</div>
</div>
<div class="paragraph">
<p>Within a <em>test suite</em> different similar <em>test cases</em> with modified parameters or adjusted solver settings can be stored. <em>Test cases</em> are grouped in test suites mostly when they use the same FMUs or other input files.</p>
</div>
<div class="paragraph">
<p>For each <em>test case</em> a <em>MasterSim</em> project file exists with the extension <code>msim</code>. The script that runs the test cases processes all <code>msim</code> files found in the subdirectory structure below the current platform.</p>
</div>
<div class="paragraph">
<p>For a test case to pass the check, a set of reference results must be present, stored in a subdirectory with name</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;project_file_without_extension&gt;.&lt;compiler&gt;_&lt;platform&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>FeedthroughTest.gcc_linux
FeedthroughTest.vc14_win64</pre>
</div>
</div>
<div class="paragraph">
<p>These directories are basically renamed working directories after a simulation run, where everything except <code>summary.txt</code> and <code>values.csv</code> has been removed.</p>
</div>
</div>
<div class="sect3">
<h4 id="_running_the_tests">5.1.2. Running the tests</h4>
<div class="paragraph">
<p>The tests are run automatically after building with the build scripts. Otherwise run the appropriate script:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>build/cmake/run_tests_win32.bat</code></p>
</li>
<li>
<p><code>build/cmake/run_tests_win64.bat</code></p>
</li>
<li>
<p><code>build/cmake/run_tests.sh</code></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_updating_reference_results">5.1.3. Updating reference results</h4>
<div class="paragraph">
<p>From within a test directory, call the script <code>update_reference_results.py</code> with the directory suffix as argument.</p>
</div>
<div class="paragraph">
<p>For example, from within:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>data/tests/linux64/Math_003_control_loop</pre>
</div>
</div>
<div class="paragraph">
<p>call:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="o">&gt;</span> ../../../../scripts/TestSuite/update_reference_results.py gcc_linux</code></pre>
</div>
</div>
<div class="paragraph">
<p>which will update all reference results in this directory. If you want to process/update the reference results of several test suites, execute the following script from one directory up, for example from <code>data/tests/linux64</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="o">&gt;</span> ../../../scripts/TestSuite/update_reference_results_in_subdirs.py gcc_linux</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_cross_checking_rules_and_fmi_standard_org_listing">5.2. Cross-Checking Rules and FMI Standard.org Listing</h3>
<div class="paragraph">
<p>See documentation in subdirectory <code>cross-check</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_ways_to_generate_test_fmus">5.3. Ways to generate test FMUs</h3>
<div class="sect3">
<h4 id="_custom_c_fmus">5.3.1. Custom C++ FMUs</h4>
<div class="paragraph">
<p>A convenient way to get simple, very specific test FMUs is the use of the <a href="https://github.com/ghorwin/FMICodeGenerator">FMI Code Generator</a> tool. Its a python tool with graphical interface where FMU variables and properties can be defined. With that information, the code generator creates a source code directory with template code and related build scripts - such that it is very easy to handcraft own FMUs. See documentation/tutorial on the github page.</p>
</div>
</div>
<div class="sect3">
<h4 id="_fmus_exported_from_simulationx">5.3.2. FMUs exported from SimulationX</h4>
<div class="paragraph">
<p>Requires a suitable license. Exporting FMUs from SimX is very easy, but limited to the Windows platform.</p>
</div>
</div>
<div class="sect3">
<h4 id="_fmus_exported_from_openmodelica">5.3.3. FMUs exported from OpenModelica</h4>
<div class="paragraph">
<p>OpenModelica can export FMUs as well. Here are the steps to generate such an FMU.</p>
</div>
<div class="sect4">
<h5 id="_create_modelica_model">Create Modelica Model</h5>
<div class="paragraph">
<p>Create a modelica model.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Annotate variables to be used as output quantities with keyword <code>output</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="n">model</span> <span class="n">BouncingBall</span> <span class="s">"The 'classic' bouncing ball model"</span>
  <span class="n">type</span> <span class="n">Height</span><span class="o">=</span><span class="n">Real</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="s">"m"</span><span class="p">);</span>
  <span class="n">type</span> <span class="n">Velocity</span><span class="o">=</span><span class="n">Real</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="s">"m/s"</span><span class="p">);</span>
  <span class="n">parameter</span> <span class="n">Real</span> <span class="n">e</span><span class="o">=</span><span class="mf">0.8</span> <span class="s">"Coefficient of restitution"</span><span class="p">;</span>
  <span class="n">parameter</span> <span class="n">Height</span> <span class="n">h0</span><span class="o">=</span><span class="mf">1.0</span> <span class="s">"Initial height"</span><span class="p">;</span>
  <span class="n">output</span> <span class="n">Height</span> <span class="n">h</span> <span class="s">"Height"</span><span class="p">;</span>
  <span class="n">output</span> <span class="n">Velocity</span> <span class="n">v</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">fixed</span><span class="o">=</span><span class="nb">true</span><span class="p">)</span> <span class="s">"Velocity"</span><span class="p">;</span>
  <span class="n">output</span> <span class="n">Integer</span> <span class="nf">bounceCounter</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">);</span>
  <span class="n">output</span> <span class="n">Boolean</span> <span class="n">falling</span><span class="p">;</span>
<span class="n">initial</span> <span class="n">equation</span>
  <span class="n">h</span> <span class="o">=</span> <span class="n">h0</span><span class="p">;</span>
<span class="n">equation</span>
  <span class="n">v</span> <span class="o">=</span> <span class="n">der</span><span class="p">(</span><span class="n">h</span><span class="p">);</span>
  <span class="n">der</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="mf">9.81</span><span class="p">;</span>
  <span class="k">if</span> <span class="n">v</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="n">then</span>
    <span class="n">falling</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
  <span class="k">else</span>
    <span class="n">falling</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
  <span class="n">end</span> <span class="k">if</span><span class="p">;</span>
  <span class="n">when</span> <span class="n">h</span><span class="o">&lt;</span><span class="mi">0</span> <span class="n">then</span>
    <span class="nf">reinit</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="o">-</span><span class="n">e</span><span class="o">*</span><span class="n">pre</span><span class="p">(</span><span class="n">v</span><span class="p">));</span>
    <span class="n">bounceCounter</span> <span class="o">=</span> <span class="n">pre</span><span class="p">(</span><span class="n">bounceCounter</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
  <span class="n">end</span> <span class="n">when</span><span class="p">;</span>
<span class="n">annotation</span><span class="p">(</span>
    <span class="n">experiment</span><span class="p">(</span><span class="n">StartTime</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">StopTime</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">Tolerance</span> <span class="o">=</span> <span class="mf">1e-6</span><span class="p">,</span> <span class="n">Interval</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">));</span>
<span class="n">end</span> <span class="n">BouncingBall</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_variant_1_generate_fmu_manually">Variant 1: Generate FMU manually</h5>
<div class="paragraph">
<p>First open OMShell, then type the following commands to load the model and generate a co-simulation FMU:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="o">&gt;&gt;</span> loadFile<span class="o">(</span><span class="s2">"/path/to/modelica/models/BouncingBall/BouncingBall.mo"</span><span class="o">)</span>
<span class="o">&gt;&gt;</span> translateModelFMU<span class="o">(</span>BouncingBall, <span class="nv">fmuType</span><span class="o">=</span><span class="s2">"cs"</span><span class="o">)</span>
<span class="s2">"/tmp/OpenModelica/BouncingBall.fmu"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The output indicates that the FMU file <code>/tmp/OpenModelica/BouncingBall.fmu</code> has been successfully created.</p>
</div>
<div class="paragraph">
<p>For Version 2.0 of FMI standard use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="o">&gt;&gt;</span> translateModelFMU<span class="o">(</span>BouncingBall, <span class="nv">fmuType</span><span class="o">=</span><span class="s2">"cs"</span>, <span class="nv">version</span><span class="o">=</span><span class="s2">"2.0"</span><span class="o">)</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_variant_2_script_based_automatic_fmu_generation">Variant 2: Script-based automatic FMU generation</h5>
<div class="paragraph">
<p>Create a script file (<code>createFMU.mos</code>)  with the following content:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="c++"><span class="n">loadModel</span><span class="p">(</span><span class="n">Modelica</span><span class="p">,</span> <span class="p">{</span><span class="s">"3.2.1"</span><span class="p">});</span> <span class="n">getErrorString</span><span class="p">();</span>
<span class="n">loadModel</span><span class="p">(</span><span class="n">Modelica_DeviceDrivers</span><span class="p">);</span> <span class="n">getErrorString</span><span class="p">();</span>

<span class="n">setLanguageStandard</span><span class="p">(</span><span class="s">"3.3"</span><span class="p">);</span> <span class="n">getErrorString</span><span class="p">();</span>

<span class="n">cd</span><span class="p">(</span><span class="s">"./fmus"</span><span class="p">);</span>
<span class="n">loadFile</span><span class="p">(</span><span class="s">"../reference_Modelica/BouncingBall.mo"</span><span class="p">);</span> <span class="n">getErrorString</span><span class="p">();</span>

<span class="n">setDebugFlags</span><span class="p">(</span><span class="s">"backenddaeinfo"</span><span class="p">);</span><span class="n">getErrorString</span><span class="p">();</span>
<span class="n">translateModelFMU</span><span class="p">(</span><span class="n">BouncingBall</span><span class="p">,</span> <span class="n">fmuType</span><span class="o">=</span><span class="s">"cs"</span><span class="p">);</span> <span class="n">getErrorString</span><span class="p">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Run the script via:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="o">&gt;</span> omc createFMU.mos</code></pre>
</div>
</div>
<hr>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_features_assisting_in_fmu_development_and_debugging">6. Features assisting in FMU development and debugging</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section describes some of the features of <em>MasterSim</em>, that are particularly useful for developers of own FMUs or to identify calculation problems with third-party FMUs.</p>
</div>
<div class="sect2">
<h3 id="_modifyingfixing_fmu_content">6.1. Modifying/fixing FMU content</h3>
<div class="paragraph">
<p>If an FMU has an invalid <code>modelDescription.xml</code> file, the process of unpacking the FMU, fixing the file, packing the FMU again and re-trying the simulation with a co-simulation master may be time consuming. With <em>MasterSim</em> you run the simulation once and get the FMU extracted in the respective <code>fmus</code> subdir. There, you can inspect all files and fix errors, or add missing files.</p>
</div>
<div class="paragraph">
<p>Next time you run <em>MasterSimulator</em>, pass the command line option <code>--skip-unzip</code> and <em>MasterSim</em> will skip over the unzip step and directly access the files in the extraction directory.</p>
</div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_developer_information">7. Developer information</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The information provided in this chapter will eventually be moved into the <em>MasterSim Developers Guide</em>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_building_the_library_and_executables">7.1. Building the Library and Executables</h3>
<div class="sect3">
<h4 id="_building_on_the_command_line">7.1.1. Building on the command line</h4>
<div class="sect4">
<h5 id="_linuxmacos">Linux/MacOS</h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">cd </span>build/cmake
./build.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>In case of missing dependencies (zlib is required) you may want to install the corresponding development packages.</p>
</div>
</div>
<div class="sect4">
<h5 id="_windows">Windows</h5>
<div class="paragraph">
<p>Convenience scripts are included for building with Visual Studio 2015 and Qt5 (for the user interface of <em>MasterSim</em>). Other compilers such as MinGw work as well, but file paths need to be configured manually.</p>
</div>
<div class="paragraph">
<p>The files are located in the <code>build/cmake</code> directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>build\cmake\build_VC.bat <i class="conum" data-value="1"></i><b>(1)</b>
build\cmake\build_VC_x64.bat <i class="conum" data-value="2"></i><b>(2)</b></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>for x86 builds</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>for x64 builds</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For the scripts to work, Qt must be installed in the following location:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>c:\Qt\5.11.3\msvc2015 <i class="conum" data-value="1"></i><b>(1)</b>
c:\Qt\5.11.3\msvc2015_64 <i class="conum" data-value="2"></i><b>(2)</b></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>for x86 builds</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>for x64 builds</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>and <strong>jom.exe</strong> is found at:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>c:\Qt\Tools\QtCreator\bin\jom.exe</pre>
</div>
</div>
<div class="paragraph">
<p>Also, <code>cmake</code> must be in the path. If installed elsewhere, the environment variables <code>JOM_PATH</code> and <code>CMAKE_PREFIX_PATH</code> can be set alternatively (see build-batch files).</p>
</div>
<div class="paragraph">
<p>With this setup, you can now build either in 32-bit or 64-bit mode:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="batch"><span class="nb">cd</span> <span class="kd">build</span>\cmake
<span class="kd">build_VC14</span>.bat</code></pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="batch"><span class="nb">cd</span> <span class="kd">build</span>\cmake
<span class="kd">build_VC14_x64</span>.bat</code></pre>
</div>
</div>
<div class="paragraph">
<p>For different Visual Studio versions or MinGW copy batch file and edit path constants. You may also want to edit these batch files if you have different installation paths.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_external_libraries">7.1.2. External Libraries</h4>
<div class="paragraph">
<p>The <em>MasterSim</em> library and the simulator projects depend on the following external/third-party libraries (except for Qt, all are included in the source code repository, so it is not necessary to install these libraries separately):</p>
</div>
<div class="paragraph">
<p><strong>MasterSimulator</strong> and <strong>MasterSimulatorUI</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>IBK library (from IBK, TU Dresden, Germany)</p>
</li>
<li>
<p>IBKMK library (from IBK, TU Dresden, Germany), subset of the math-kernel library from IBK</p>
</li>
<li>
<p>TiCPP library (adapted version provided by IBK, TU Dresden, Germany)</p>
</li>
<li>
<p>minizip and zlib for unzipping FMUs</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>only <strong>MasterSimulatorUI</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.qt.io/developers">Qt 5 Library</a></p>
</li>
<li>
<p><a href="https://github.com/ghorwin/BlockMod">BlockMod library</a> (from IBK, TU Dresden, Germany, hosted on github)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The release-versions of the libraries (with the exception of Qt) are located in the sub-directory <code>third-party</code>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The libraries in the third-party subdir are way outdated. Please only use the source code in the <code>externals</code> subdirectory of the repository.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_development_environments_and_projectsession_files">7.2. Development environments and project/session files</h3>
<div class="sect3">
<h4 id="_qt_creator">7.2.1. Qt Creator</h4>
<div class="paragraph">
<p>Development with Qt Creator is encouraged and project files are provided. Individual project files are in subdirectories</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;library/app&gt;/projects/Qt/&lt;library/app&gt;.pro</pre>
</div>
</div>
<div class="paragraph">
<p>Executables are placed in</p>
</div>
<div class="literalblock">
<div class="content">
<pre>bin/debug        - output path for development with Qt Creator
bin/release      - default output path for cmake-builds</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_visual_studio">7.2.2. Visual Studio</h4>
<div class="sect4">
<h5 id="_cmake_generated_vc_project_files">CMake-generated VC project files</h5>
<div class="paragraph">
<p>The simplest variant that should always work is to use CMake-generated VC project files and solution.</p>
</div>
<div class="paragraph">
<p>Basic steps: Open a console window, setup VC build environment and all required paths, then use cmake with the Visual Studio makefile generator.</p>
</div>
<div class="paragraph">
<p>You can re-use the <code>build.bat</code> or <code>built_x64.bat</code> files for that purpose. Open a command line window and change into the directory <code>build/cmake</code>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>start either  <code>build.bat</code> or <code>built_x64.bat</code> and press Ctrl+C once building starts.</p>
</li>
<li>
<p>leave subdirectory and create a new subdirectory vc:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="batch"><span class="o">&gt;</span> <span class="nb">mkdir</span> <span class="kd">vc</span>
<span class="o">&gt;</span> <span class="nb">cd</span> <span class="kd">vc</span></code></pre>
</div>
</div>
</li>
<li>
<p>open cmake gui, given the parent directory as source dir and select a Visual Studio build generator</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="batch"><span class="o">&gt;</span> <span class="kd">cmake</span><span class="na">-gui </span>..</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_prepared_vc_project_files">Prepared VC project files</h5>
<div class="paragraph">
<p>You can also open the VC solution files in <code>build\VC14\MasterSim.sln</code>.
<strong>Note</strong>: You have to build first the cmake to configure the zlib <code>zconf.h</code> file!</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_helpful_stuff_related_to_development_on_linux">7.3. Helpful stuff related to development on Linux</h3>
<div class="paragraph">
<p>Here are some notes collected when I encountered some unexpected difficulties while creating this master simulator:</p>
</div>
<div class="sect3">
<h4 id="_checking_symbols_in_shared_libraries">7.3.1. Checking symbols in shared libraries</h4>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">objdump <span class="nt">-t</span> &lt;shared_library&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>To get all fmi2  functions</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">objdump <span class="nt">-t</span> &lt;shared_library&gt; | <span class="nb">grep </span>fmi2</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_linking_shared_libraries_with_static_members_that_occurs_in_executables_as_well">7.3.2. Linking shared libraries with static members (that occurs in executables as well)</h4>
<div class="paragraph">
<p><strong>Problem:</strong> Source of the problem: both FMU and master use IBK library, which in turn has static members/singletons (e.g. message handler). When linking FMU to exe, during cleanup at exit of main the destructor of the singleton object is called twice, causing a segfault.</p>
</div>
<div class="paragraph">
<p><strong>Solution:</strong>
None yet, appears to work after "duplicate so-import check" added.</p>
</div>
</div>
<div class="sect3">
<h4 id="_fmu_debugging">7.3.3. FMU Debugging</h4>
<div class="paragraph">
<p>Assuming you develop the shared FMU library with Qt Creator, you can follow this procedure:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>build your FMU either in debug more or release-with-debug-symbols, you can use also an external build tool chain, for example cmake</p>
</li>
<li>
<p>compose your FMU and zip it into the fmu archive (you need to do this only once); MIND: the shared library within the FMU must be the one created by Qt Creator.</p>
</li>
<li>
<p>create your msim test project</p>
</li>
<li>
<p>in Qt Creator, open and activate the MasterSimulator project, select the msim project as command line argument and start debugging - it will extract the fmus and attach to the shared library functions</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can now either debug and step into the FMU fmi2xxx functions, or open the source files that you used for creating the FMU and set breakpoints. Qt Creator will automatically pick that up and you can debug/step through the master and the FMUs alike.</p>
</div>
<div class="sect4">
<h5 id="_example_when_debugging_separate_fmu_project_which_is_statically_built_in_release_mode_but_dynamically_linked_to_other_libs_during_development">Example when debugging separate FMU project which is statically built in release mode, but dynamically linked to other libs during development</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The FMU is created (first with the statically linked FMU <code>Test.so</code>) and the MasterSim project is set up</p>
</li>
<li>
<p><em>MasterSim</em> is run once and the directory structure is created, the FMU is extracted and started without debugger attached.</p>
</li>
<li>
<p>Now in  Qt Creator the  FMU development project builds <code>libTest.so.2.0.1</code> which links to other dynamic libraries in the development directory.</p>
</li>
<li>
<p>The FMU file is renamed to <code>Test.so</code> and copied into the extracted fmu directory, hereby overwriting the statically linked FMU</p>
</li>
<li>
<p>The library search path to the other dynamic libraries that <code>libTest.so.2.0.1</code> links to is added to the MasterSim&#8217;s project environment <code>LD_LIBRARY_PATH</code> variable</p>
</li>
<li>
<p><code>MasterSimulator</code> is started in debugging mode using the <code>--skip-unzip</code> command line option</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_inside_mastersim">7.4. Inside MasterSim</h3>
<div class="sect3">
<h4 id="_data_types">7.4.1. Data Types</h4>
<div class="paragraph">
<p>In simulations with mixed FMUs (v1 and v2) data types should match. Also, the default type-headers are the same for both versions.</p>
</div>
<div class="paragraph">
<p>Intendet platform for this master is Desktop systems (32bit/64bit), therefore all data types seen by the master algorithms are mapped to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>fmi2Boolean</code> (<code>bool</code> in scalar interface functions)</p>
</li>
<li>
<p><code>int</code></p>
</li>
<li>
<p><code>double</code></p>
</li>
<li>
<p><code>std::string</code></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_connection_graph_and_variable_mapping">7.4.2. Connection Graph and Variable Mapping</h4>
<div class="paragraph">
<p>Variables can be uniquely identified by</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;slave-name&gt;.&lt;variable-name&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>and a graph may be defined by:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>A.x1         B.u1
A.d1         C.du1
B.x1         C.u1
B.x2         A.u2
C.x1         A.u1</pre>
</div>
</div>
<div class="paragraph">
<p>First colum are output variables, second column are connected input variables. x are of type real, d of type integer.</p>
</div>
<div class="paragraph">
<p>Each slave holds for each data type a vector of output values (bool, int, real/double, string).
The master also holds for each data type a vector of connection variables.</p>
</div>
<div class="paragraph">
<p>A mapping of variables from local slave storage to global vector and from global vector to input is done with a mapping table for each data type individually:</p>
</div>
<div class="paragraph">
<p><strong>Output mapping - Type Real</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Slave</th>
<th class="tableblock halign-left valign-top">VariableName</th>
<th class="tableblock halign-left valign-top">global index</th>
<th class="tableblock halign-left valign-top">local index</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">B</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">B</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The transfer from local to global data storage is then a simple algorithm:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>loop connectedVariableIndexes:
    copy(localArray[localIndex], globalArray[globalIndex])</pre>
</div>
</div>
<div class="paragraph">
<p>In case of slave B the array connectedVariableIndexes will be [0, 1].</p>
</div>
<div class="paragraph">
<p><strong>Input mapping - Type Real</strong></p>
</div>
<div class="paragraph">
<p>For input variables a similar mapping exists. Each slave does not have an input variable cache, instead variables are set individually (see also Newton algorithm and Jacobian generation via DQ algorithm).</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Slave</th>
<th class="tableblock halign-left valign-top">VariableName</th>
<th class="tableblock halign-left valign-top">global index</th>
<th class="tableblock halign-left valign-top">local value reference</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">B</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">u1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">55</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">u1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">348432</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">u2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">122</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">u1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">321</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Input and output mappings are combined into a single table RealVariableMappings.</p>
</div>
<div class="paragraph">
<p><strong>Note</strong>: An output of a slave may be directly connected to any of its own input variables, for example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>fmu1.var2   fmu1.var15</pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 0.8.2<br>
Last updated 2019-11-13 15:07:22 +0100
</div>
</div>
<style>
pre.rouge table td { padding: 5px; }
pre.rouge table pre { margin: 0; }
pre.rouge .cm {
  color: #999988;
  font-style: italic;
}
pre.rouge .cp {
  color: #999999;
  font-weight: bold;
}
pre.rouge .c1 {
  color: #999988;
  font-style: italic;
}
pre.rouge .cs {
  color: #999999;
  font-weight: bold;
  font-style: italic;
}
pre.rouge .c, pre.rouge .ch, pre.rouge .cd, pre.rouge .cpf {
  color: #999988;
  font-style: italic;
}
pre.rouge .err {
  color: #a61717;
  background-color: #e3d2d2;
}
pre.rouge .gd {
  color: #000000;
  background-color: #ffdddd;
}
pre.rouge .ge {
  color: #000000;
  font-style: italic;
}
pre.rouge .gr {
  color: #aa0000;
}
pre.rouge .gh {
  color: #999999;
}
pre.rouge .gi {
  color: #000000;
  background-color: #ddffdd;
}
pre.rouge .go {
  color: #888888;
}
pre.rouge .gp {
  color: #555555;
}
pre.rouge .gs {
  font-weight: bold;
}
pre.rouge .gu {
  color: #aaaaaa;
}
pre.rouge .gt {
  color: #aa0000;
}
pre.rouge .kc {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kd {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kn {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kp {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kr {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kt {
  color: #445588;
  font-weight: bold;
}
pre.rouge .k, pre.rouge .kv {
  color: #000000;
  font-weight: bold;
}
pre.rouge .mf {
  color: #009999;
}
pre.rouge .mh {
  color: #009999;
}
pre.rouge .il {
  color: #009999;
}
pre.rouge .mi {
  color: #009999;
}
pre.rouge .mo {
  color: #009999;
}
pre.rouge .m, pre.rouge .mb, pre.rouge .mx {
  color: #009999;
}
pre.rouge .sb {
  color: #d14;
}
pre.rouge .sc {
  color: #d14;
}
pre.rouge .sd {
  color: #d14;
}
pre.rouge .s2 {
  color: #d14;
}
pre.rouge .se {
  color: #d14;
}
pre.rouge .sh {
  color: #d14;
}
pre.rouge .si {
  color: #d14;
}
pre.rouge .sx {
  color: #d14;
}
pre.rouge .sr {
  color: #009926;
}
pre.rouge .s1 {
  color: #d14;
}
pre.rouge .ss {
  color: #990073;
}
pre.rouge .s, pre.rouge .sa, pre.rouge .dl {
  color: #d14;
}
pre.rouge .na {
  color: #008080;
}
pre.rouge .bp {
  color: #999999;
}
pre.rouge .nb {
  color: #0086B3;
}
pre.rouge .nc {
  color: #445588;
  font-weight: bold;
}
pre.rouge .no {
  color: #008080;
}
pre.rouge .nd {
  color: #3c5d5d;
  font-weight: bold;
}
pre.rouge .ni {
  color: #800080;
}
pre.rouge .ne {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nf, pre.rouge .fm {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nl {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nn {
  color: #555555;
}
pre.rouge .nt {
  color: #000080;
}
pre.rouge .vc {
  color: #008080;
}
pre.rouge .vg {
  color: #008080;
}
pre.rouge .vi {
  color: #008080;
}
pre.rouge .nv, pre.rouge .vm {
  color: #008080;
}
pre.rouge .ow {
  color: #000000;
  font-weight: bold;
}
pre.rouge .o {
  color: #000000;
  font-weight: bold;
}
pre.rouge .w {
  color: #bbbbbb;
}
pre.rouge {
  background-color: #f8f8f8;
}
</style>
</body>
</html>